!function(){let e;async function t(){try{let e,t,s,n,a,d,r;u(),await firebase.app().functions("europe-west1").httpsCallable("updateFirebaseUser")({...(e=document.getElementById("addressFirstName").value,t=document.getElementById("addressLastName").value,s=document.getElementById("addressStreetAddress").value,n=document.getElementById("addressCO").value,a=document.getElementById("addressPostalCode").value,d=document.getElementById("addressCity").value,r=document.getElementById("addressDoorCode").value,e=e?e.trim().charAt(0).toUpperCase()+e.trim().slice(1):"",t=t?t.trim().charAt(0).toUpperCase()+t.trim().slice(1):"",s=s?s.trim().charAt(0).toUpperCase()+s.trim().slice(1):"",n=n?n.trim():"",a=a?a.trim().replace(/\D/g,""):"",d=d?d.trim().charAt(0).toUpperCase()+d.trim().slice(1):"",{addressFirstName:e,addressLastName:t,addressStreetAddress:s,addressCO:n,addressPostalCode:a,addressCity:d,addressDoorCode:r=r?r.trim():""})}),await o()}catch(e){errorHandler.report(e),console.log("Error updating user",e)}}async function s(){u();let e="",t=document.getElementsByName("shippingMethodSettings");for(let s=0;s<t.length;s++)t[s].checked&&(e=t[s].value);// "Service point" or "Pickup"
await firebase.app().functions("europe-west1").httpsCallable("updateFirebaseUser")({preferences:{shippingMethod:e}}),await o()}async function n(e){try{let t;u(),await firebase.app().functions("europe-west1").httpsCallable("updateFirebaseUser")({...(t=e?swishNumber.value.trim():phoneNumber.value.trim(),e?{swishPayeeAlias:formatPhoneNumber(t)}:{phoneNumber:formatPhoneNumber(t)})}),await o()}catch(e){errorHandler.report(e)}}async function a(){try{let e;u(),await firebase.app().functions("europe-west1").httpsCallable("updateFirebaseUser")({personalId:(e=personalId.value.trim().replace(/\D/g,"").replace("-",""),(12!==e.length&&("19"!==e.substring(0,2)||"20"!==e.substring(0,2))&&(e=99>=Number(e.substring(0,2))&&Number(e.substring(0,2))>25?"19"+e:"20"+e),12===e.length)?e:null)}),await o()}catch(e){errorHandler.report(e),console.log("Error updating user",e)}}let d="",r=document.getElementById("pageTitleText");async function i(t){try{let t=await firebase.app().functions("europe-west1").httpsCallable("getUserInfo")();e=t.data,await l(e.personalId),console.log("data",e);let s=e?.preferences?.shippingMethod||null;console.log("shippingMethod",s),addressDisplay.innerHTML=e.addressStreetAddress?`${e.addressFirstName} ${e.addressLastName}${e.addressCO?`, C/o ${e.addressCO}`:""}<br/>${e.addressStreetAddress}<br/>${e.addressPostalCode} ${e.addressCity}`:"-",console.log("address displayed"),swishNumberDisplay.innerHTML=e.swishPayeeAlias||"-",console.log("swish displayed"),phoneNumberDisplay.innerHTML=e.phoneNumber||"-",console.log("phoneNumberDisplay"),console.log("data.phoneNumber",e.phoneNumber),s?("Pickup"===s&&(shippingPreferencesDisplay.innerHTML="Upph\xe4mtning vid d\xf6rren"),"Service point"===s&&(shippingPreferencesDisplay.innerHTML="L\xe4mna till ombud")):shippingPreferencesDisplay.innerHTML="-"}catch(e){errorHandler.report(e),console.log("error fetching user data",e)}finally{t||(loadingDiv.style.display="none",settingsContainer.style.display="block")}}async function l(e){let t="-";if((d=e||"").length>4){t=d.substring(d.length-4),personalIdDisplay.innerHTML=`XXXXXXXX${t}`;return}personalIdDisplay.innerHTML=t}async function o(){await i(!0),savedCheckIcon.style.display="flex",saveLoadingSpinner.style.display="none"}function u(){saveButton.style.display="none",saveLoadingSpinner.style.display="flex"}function p(e,t,s,n){document.getElementById(t).style.display="block",document.getElementById("updateContainer").style.display="block",document.getElementById("goBackDiv").style.display="none",document.getElementById("resetPageDiv").style.display="block",saveButton.style.display="block",saveButtonContainer.style.display="flex",settingsContainer.style.display="none",r.innerHTML=n,r.value=n,s&&(s===personalId?s.value=d:s.value=document.getElementById(e).innerHTML.length>2?document.getElementById(e).innerHTML:"",s.dispatchEvent(new Event("input"))),"shippingPrefForm"===t&&(document.getElementById(e).innerHTML.includes("ombud")&&(servicePointSettings.previousElementSibling.classList.add("w--redirected-checked"),servicePointSettings.checked=!0),document.getElementById(e).innerHTML.includes("Upph\xe4mtning")&&(pickupSettings.previousElementSibling.classList.add("w--redirected-checked"),pickupSettings.checked=!0))}function c(e){return!!e.validity.valid&&"Spara"===saveButton.innerHTML}function m(e,t){e.style.display=t?"inline-block":"none"}function y(){saveButton.style.display="flex",savedCheckIcon.style.display="none",saveLoadingSpinner.style.display="none"}//Address
adressDiv.addEventListener("click",async function(){var t;await (t=e,void(document.getElementById("addressFirstName").value=t.addressFirstName||"",document.getElementById("addressFirstName").dispatchEvent(new Event("input")),document.getElementById("addressLastName").value=t.addressLastName||"",document.getElementById("addressLastName").dispatchEvent(new Event("input")),document.getElementById("addressStreetAddress").value=t.addressStreetAddress||"",document.getElementById("addressStreetAddress").dispatchEvent(new Event("input")),document.getElementById("addressCO").value=t.addressCO||"",document.getElementById("addressCO").dispatchEvent(new Event("input")),document.getElementById("addressPostalCode").value=t.addressPostalCode||"",document.getElementById("addressPostalCode").dispatchEvent(new Event("input")),document.getElementById("addressCity").value=t.addressCity||"",document.getElementById("addressCity").dispatchEvent(new Event("input")),document.getElementById("addressDoorCode").value=t.addressDoorCode||"",document.getElementById("addressDoorCode").dispatchEvent(new Event("input")))),p("adressDiv","addressForm",null,"Adress")}),addressFirstName.addEventListener("input",function(){m(firstNameLabel,addressFirstName.value),y()}),addressLastName.addEventListener("input",function(){m(lastNameLabel,addressLastName.value),y()}),addressStreetAddress.addEventListener("input",function(){m(streetAddressLabel,addressStreetAddress.value),y()}),addressCO.addEventListener("input",function(){m(addressCoLabel,addressCO.value),y()}),addressPostalCode.addEventListener("input",function(){m(postalCodeLabel,addressPostalCode.value),y()}),addressCity.addEventListener("input",function(){m(cityLabel,addressCity.value),y()}),addressDoorCode.addEventListener("input",function(){m(doorCodeLabel,addressDoorCode.value),y()}),//Phone
phoneDiv.addEventListener("click",function(){p("phoneNumberDisplay","phoneForm",phoneNumber,"Mobilnummer")}),phoneNumber.addEventListener("input",function(){m(phoneNumberLabel,phoneNumber.value),y();let e=formatPhoneNumber(phoneNumber.value),t=e.length>=12&&e.includes("+")?"":"Ogiltigt mobilnummer";phoneNumber.setCustomValidity(t)}),//Shipping
shippingPrefDiv.addEventListener("click",function(){p("shippingPreferencesDisplay","shippingPrefForm",null,"Skicka plagg")}),//Swish
swishDiv.addEventListener("click",function(){p("swishNumberDisplay","swishForm",swishNumber,"Swish")}),swishNumber.addEventListener("input",()=>{m(swishNumberLabel,swishNumber.value),y();let e=0!==swishNumber.length?"":"Ogiltigt swishnummer";swishNumber.setCustomValidity(e)}),personIdDiv.addEventListener("click",function(){p("fullPersonId","personIdForm",personalId,"Personnummer")}),personalId.addEventListener("input",()=>{m(personalIdLabel,personalId.value),y();let e=!function(e){// verify we got 10 digits, otherwise it is invalid
if(10!==(e=e.replace(/\D/g,"")// strip out all but digits
.split("")// convert string to array
.reverse()// reverse order for Luhn
.slice(0,10)).length)return!1;let t=e.map(e=>Number(e)).reduce((e,t,s)=>(s%2&&(t*=2),t>9&&(t-=9),e+t));return 0==t%10}(personalId.value)?"Ogiltigt personnummer":"";personalId.setCustomValidity(e)}),saveButton.addEventListener("click",async function(){switch(r.value){case"Adress":(function(e){let t=!0;for(let s of e)s.validity.valid||(t=!1);return!!t&&"Spara"===saveButton.innerHTML})([addressFirstName,addressLastName,addressCity,addressPostalCode,addressStreetAddress])&&await t(),addressFirstName.reportValidity(),addressLastName.reportValidity(),addressCity.reportValidity(),addressPostalCode.reportValidity(),addressStreetAddress.reportValidity();break;case"Skicka plagg":await s();break;case"Personnummer":c(personalId)&&await a(),personalId.reportValidity();break;case"Swish":c(swishNumber)&&await n(!0),swishNumber.reportValidity();break;case"Mobilnummer":c(phoneNumber)&&await n(),phoneNumber.reportValidity()}}),resetPageButton.addEventListener("click",()=>{document.getElementById({Adress:"addressForm",Mobilnummer:"phoneForm",Swish:"swishForm",Personnummer:"personIdForm","Skicka plagg":"shippingPrefForm"}[r.value]).style.display="none",document.getElementById("updateContainer").style.display="none",document.getElementById("goBackDiv").style.display="block",document.getElementById("resetPageDiv").style.display="none",settingsContainer.style.display="block",saveButton.style.display="none",saveLoadingSpinner.style.display="none",savedCheckIcon.style.display="none",r.innerHTML="Inst\xe4llningar",r.value="Inst\xe4llningar"}),i()}();//# sourceMappingURL=settings.js.map

//# sourceMappingURL=settings.js.map
