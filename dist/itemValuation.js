!function(){async function e(e){document.getElementById("valuationHeading").style.display="none",document.getElementById("valuationMotivation").style.display="none",document.getElementById("valuationText").innerText="S\xe4ljer ej",document.getElementById("valuationText").style.display="block",document.getElementById("rejectButton").style.display="none",document.getElementById("confirmButton").style.display="none",document.getElementById("okejButton").style.display="flex",document.getElementById("newItemButton").style.display="flex",document.getElementById("declineExplanation").style.display="block",document.getElementById("valuationRange").style.display="none",document.getElementById("adjustIntervalButton").style.display="none",document.getElementById("valuationExplanation").style.display="none",document.getElementById("valuationExplanationHeader").style.display="none",document.getElementById("chatDiv").style.display="block",document.getElementById("newItemButton").addEventListener("click",()=>{sessionStorage.removeItem("itemToBeCreatedAfterSignIn"),localStorage.removeItem("newItem"),sessionStorage.removeItem("newItemId"),sessionStorage.removeItem("itemValuation"),window.location.href="/sell-item"}),document.getElementById("okejButton").addEventListener("click",()=>{sessionStorage.removeItem("itemToBeCreatedAfterSignIn"),localStorage.removeItem("newItem"),sessionStorage.removeItem("newItemId"),sessionStorage.removeItem("itemValuation"),window.location.href="/private"}),e.id&&await firebase.app().functions("europe-west1").httpsCallable("markItemRejected")({itemId:e.id,userDecline:!1})}window.itemValuationJsLoaded=!0;let t=(e,t)=>{let n=document.getElementById("minPrice").value,i=document.getElementById("maxPrice").value;return!a(e,t,Number(n),Number(i))},n=(e,t)=>!!(e<500)&&!!(t>1.5*e)||!!(e>=500)&&!!(e<1e3)&&!!(t>1.4*e)||!!(e>=1e3)&&!!(t>1.3*e),i=(e,t,i)=>n(e,i)||i>p(e,t),a=(e,t,a,l)=>i(e,t,a)||n(t,l),l=(e,t)=>n(e,t)?"Ovanligt h\xf6gt startpris":null,r=(e,t)=>n(e,t)?"Ovanligt h\xf6gt l\xe4gsta pris":null,o=(e,t)=>e>t?"L\xe4gsta priset \xf6verstiger v\xe5r v\xe4rdering":null,d=(e,t,n,i)=>[l(t,i),r(e,n),o(n,p(e,t))].filter(e=>e).join("<br>"),m=(e,t,l,r)=>{let o=Number(l.value),m=Number(r.value);if(r.style.color=n(t,m)?"#E20000":"#333",l.style.color=i(e,t,o)?"#E20000":"#333",a(e,t,o,m))"block"!==document.getElementById("requiresReviewDiv").style.display&&(document.getElementById("requiresReviewDiv").style.display="block",analytics.track("Element Viewed",{elementID:"requiresReviewDiv"})),document.getElementById("adjustmentWarningText").innerHTML=d(e,t,o,m),document.getElementById("noteDiv").style.display="none",document.getElementById("sendForReviewButton").style.display="flex",document.getElementById("confirmButton").style.display="none",document.getElementById("rejectButton").style.display="none";else if(m!==t||o!==e){document.getElementById("confirmButton").style.display="flex",document.getElementById("sendForReviewButton").style.display="none","visible"!==document.getElementById("resetButton").style.visibility&&(document.getElementById("resetButton").style.visibility="visible",analytics.track("Element Viewed",{elementID:"resetButton"})),document.getElementById("requiresReviewDiv").style.display="none";let n=document.getElementById("noteText").innerText,i="";m>t&&(i+="Ett h\xf6jt startpris kan inneb\xe4ra att det tar l\xe4ngre tid f\xf6r\xa0plagget att s\xe4ljas."),o>e&&(i+=`${i?" ":""}Ett h\xf6jt l\xe4gsta pris minskar sannolikheten att det blir s\xe5lt.`),i||(i="Bra att du kan t\xe4nka dig s\xe4nka priset! Det \xf6kar sannolikheten att det blir s\xe5lt."),document.getElementById("noteHeading").innerHTML="Notera!",document.getElementById("noteText").innerText=i,document.getElementById("noteDiv").style.display="block",i!==n&&document.getElementById("noteDiv").click(),document.getElementById("confirmButton").innerText="P\xe5b\xf6rja f\xf6rs\xe4ljning",document.getElementById("rejectButton").style.display="flex"}else document.getElementById("resetButton").style.visibility="hidden",document.getElementById("noteHeading").innerHTML="Tips!",document.getElementById("noteText").innerText="S\xe4nkta priser ger en s\xe4krare och snabbare f\xf6rs\xe4ljning. H\xf6jda priser kan ge mer pengar, men riskerar ocks\xe5 att det blir os\xe5lt eller tar l\xe4ngre tid.",document.getElementById("noteDiv").style.display="block",document.getElementById("requiresReviewDiv").style.display="none",document.getElementById("confirmButton").style.display="flex",document.getElementById("sendForReviewButton").style.display="none",document.getElementById("rejectButton").style.display="flex"};function s(){let e=document.getElementById("minPrice"),t=document.getElementById("maxPrice"),n=Number(e.value),i=Number(t.value);return n<100?e.setCustomValidity("Vi f\xf6rs\xf6ker tyv\xe4rr aldrig s\xe4lja n\xe5got under 100kr"):n>i?(t.setCustomValidity("Startpris m\xe5ste vara h\xf6gre \xe4n l\xe4gsta pris"),e.setCustomValidity("L\xe4gsta pris m\xe5ste vara mindre \xe4n startpris")):(e.setCustomValidity(""),t.setCustomValidity("")),document.getElementById("wf-form-Valuation-form").reportValidity()}async function c(e,n,i){if(!s())return;let a=document.getElementById("minPrice"),l=Number(a.value),r=document.getElementById("maxPrice"),o=Number(r.value);if(sessionStorage.getItem("itemToBeCreatedAfterSignIn")){let e=JSON.parse(sessionStorage.getItem("itemToBeCreatedAfterSignIn"));return e.item.infoRequests.price.status="Resolved",e.item.infoRequests.price.response="Accepted",l!==n||o!==i?(e.item.infoRequests.price.userAdjustedMin=l,e.item.infoRequests.price.userAdjustedMax=o,t(n,i)?(e.item.minPriceEstimate=n,e.item.maxPriceEstimate=i):(e.item.infoRequests.price.response="User proposal",e.item.infoRequests.price.userProposalMotivation=document.getElementById("userProposalMotivation").value)):(e.item.minPriceEstimate=n,e.item.maxPriceEstimate=i),sessionStorage.setItem("itemToBeCreatedAfterSignIn",JSON.stringify(e)),window.location.href="/sign-in"}{await firebase.app().functions("europe-west1").httpsCallable("saveValuationStatus")({itemId:e,minPrice:n,maxPrice:i,adjustmentMin:l,adjustmentMax:o,userProposalMotivation:document.getElementById("userProposalMotivation").value,adjustmentRequiresReview:!t(n,i)});let a=getParamsObject();if(localStorage.getItem("latestItemCreated")&&!a.id){let e=JSON.parse(localStorage.getItem("latestItemCreated"));e.infoRequests.price.response=t(n,i)?"Accepted":"User proposal",t(n,i)&&(e.minPriceEstimate=l,e.maxPriceEstimate=o),localStorage.setItem("latestItemCreated",JSON.stringify(e))}if(document.referrer.includes("/private"))return window.location.href="/private";{let e=user.current?.phoneNumber?.length;return window.location.href=e?"/item-confirmation":"/user-contact"}}}let u=e=>{document.getElementById("itemImage").src=window.innerWidth<=400?e?.images?.enhancedFrontImageSmall||e?.images?.enhancedFrontImage||e?.images?.modelImage||e?.images?.frontImageSmall||e?.images?.frontImage:e?.images?.enhancedFrontImage||e?.images?.modelImage||e?.images?.frontImage;let{minPriceEstimate:t,newMinPriceEstimate:n,newMaxPriceEstimate:i,maxPriceEstimate:a}=e.mlValuation||{},l=e.infoRequests?.price?.minPrice||n||t,r=e.infoRequests?.price?.maxPrice||i||a;document.getElementById("chatLink").onclick=()=>Intercom("showNewMessage",e.mlValuation?.decline?`ID: ${e.id}

G\xe4llande att ni tackat nej till ${e.brand.trim()}-${e.category.toLowerCase()}:

`:`ID: ${e.id}

G\xe4llande prisintervallet p\xe5 ${l}-${r} kr f\xf6r ${e.brand.trim()}-${e.category.toLowerCase()}. Vad skulle du vilja \xe4ndra det till och varf\xf6r?

`),document.getElementById("valuationClose").addEventListener("click",()=>{sessionStorage.removeItem("itemToBeCreatedAfterSignIn");let e=getParamsObject();return e.id||(localStorage.removeItem("newItem"),sessionStorage.removeItem("newItemId")),window.location.href="/private"})},y=async e=>{e.id&&await firebase.app().functions("europe-west1").httpsCallable("markItemRejected")({itemId:e.id,userDecline:!0}),sessionStorage.removeItem("itemToBeCreatedAfterSignIn");let t=getParamsObject();return t.id||(localStorage.removeItem("newItem"),localStorage.removeItem("latestItemCreated"),sessionStorage.removeItem("newItemId")),window.location.href="/private"},g=()=>{for(let e of document.getElementsByClassName("tooltip-motivation"))e.classList.remove("tooltip-show")},I=e=>e<200?20:e<500?50:100,v=(e,t)=>{let n=Number(e.value),i=I(t),a=Math.floor(n/i)*i;e.value=Math.max(0,a===n?n-i:a),e.dispatchEvent(new Event("input"))},E=(e,t)=>{let n=Number(e.value),i=I(t),a=Math.ceil(n/i)*i;e.value=a===n?n+i:a,e.dispatchEvent(new Event("input"))},p=(e,t)=>10*Math.round((e+t)/20),B=async t=>{let{minPriceEstimate:n,newMinPriceEstimate:i,newMaxPriceEstimate:a,maxPriceEstimate:l,decline:r,newBrand:o,newBrandCategory:d}=t.mlValuation||{},m=getParamsObject();if(!m.id&&r){await e(t),document.getElementById("valuationResultDiv").style.display="flex";return}let s=t.infoRequests?.price?.minPrice||i||n,u=t.infoRequests?.price?.maxPrice||a||l;document.getElementById("valuationText").innerText=`${p(s,u)} kr`,document.getElementById("valuationResultDiv").style.display="flex",document.body.addEventListener("click",g),document.getElementById("valuationRange").style.display="flex",document.getElementById("minPrice").value=s,document.getElementById("minPrice").disabled=!0,document.getElementById("maxPrice").value=u,document.getElementById("maxPrice").disabled=!0,t.infoRequests?.price?.description?(document.getElementById("valuationExplanation").innerText=t.infoRequests.price.description,t.infoRequests?.price?.type==="Final Offer"&&(document.getElementById("valuationExplanationHeader").innerText="Motivering",document.getElementById("valuationExplanationHeader").style.display="block")):(o||d)&&(document.getElementById("valuationExplanationHeader").style.display="block",document.getElementById("valuationExplanation").innerText=o?"Vi har inte s\xe5lt s\xe5 mycket av detta varum\xe4rke tidigare och har d\xe4rf\xf6r lite mindre data. Du f\xe5r justera om du upplever att v\xe4rderingen inte \xe4r rimlig. Vi b\xf6rjar med startpriset, och justerar successivt ner till l\xe4gsta priset under s\xe4ljperioden p\xe5 30 dagar.":"Vi har inte s\xe5lt s\xe5 mycket av denna kategori fr\xe5n varum\xe4rket tidigare och har d\xe4rf\xf6r lite mindre data. Du f\xe5r justera om du upplever att v\xe4rderingen inte \xe4r rimlig. Vi b\xf6rjar med startpriset, och justerar successivt ner till l\xe4gsta priset under s\xe4ljperioden p\xe5 30 dagar."),document.getElementById("valuationText").style.display="block",sessionStorage.getItem("itemToBeCreatedAfterSignIn")&&(document.getElementById("chatDiv").style.display="none"),await x(t),document.getElementById("confirmButton").addEventListener("click",()=>c(t.id,s,u)),document.getElementById("sendForReviewButton").addEventListener("click",()=>c(t.id,s,u)),document.getElementById("rejectButton").addEventListener("click",()=>y(t))},x=async e=>{let{minPriceEstimate:t,newMinPriceEstimate:n,newMaxPriceEstimate:i,maxPriceEstimate:a,adjustmentAllowed:l}=e.mlValuation||{},r=e.infoRequests?.price?.minPrice||n||t,o=e.infoRequests?.price?.maxPrice||i||a,d=l||["1A","1B","1C","2A","3","5A","7","8"].includes(e.brandSegment)||e.infoRequests?.price?.adjustmentAllowed;d&&(document.getElementById("adjustIntervalButton").style.display="flex",analytics.track("Element Viewed",{elementID:"adjustIntervalButton"}),document.getElementById("chatDiv").style.display="none",document.getElementById("adjustIntervalButton").addEventListener("click",()=>{document.getElementById("valuationExplanation").style.display="none",document.getElementById("valuationExplanationHeader").style.display="none",document.getElementById("minPrice").disabled=!1,document.getElementById("maxPrice").disabled=!1,document.getElementById("adjustIntervalButton").style.display="none",document.getElementById("noteDiv").style.display="block",document.getElementById("origMinPrice").style.display="block",document.getElementById("origMaxPrice").style.display="block",document.getElementById("sliderDiv").style.display="block",document.querySelectorAll(".field-underline").forEach(e=>e.style.visibility="visible")})),e.infoRequests?.price?.type==="Final Offer"&&(document.getElementById("adjustIntervalButton").style.display="none",document.getElementById("chatDiv").style.display="none"),function(e,t){let n=document.getElementById("adjustmentSlider");n.addEventListener("touchend",()=>{n.value=Math.round(Number(n.value)),analytics.track("Click",{elementID:"adjustmentSlider"}),s()}),n.addEventListener("mouseup",()=>{n.value=Math.round(Number(n.value)),analytics.track("Click",{elementID:"adjustmentSlider"}),s()}),n.addEventListener("input",function(){let i=document.getElementById("minPrice"),a=document.getElementById("maxPrice"),l=Math.round(Number(n.value));switch(l){case 0:i.value=Math.max(100,10*Math.round(.5*e/10)),a.value=Math.max(100,10*Math.round(.5*t/10));break;case 1:i.value=Math.max(100,10*Math.round(.66*e/10)),a.value=Math.max(100,10*Math.round(.66*t/10));break;case 2:i.value=Math.max(100,10*Math.round(.83*e/10)),a.value=Math.max(100,10*Math.round(.83*t/10));break;case 3:i.value=e,a.value=t;break;case 4:i.value=10*Math.round((e+.33*w(e,t))/10),a.value=10*Math.round((t+.33*h(t))/10);break;case 5:i.value=10*Math.round((e+.67*w(e,t))/10),a.value=10*Math.round((t+.67*h(t))/10);break;case 6:i.value=10*Math.floor((e+w(e,t))/10),a.value=10*Math.floor((t+h(t))/10)}i.dispatchEvent(new Event("input")),a.dispatchEvent(new Event("input"))})}(r,o),document.getElementById("valuationMotivation").addEventListener("click",e=>{let t=document.getElementsByClassName("tooltip-motivation"),n=t[0]?.classList.contains("tooltip-show");for(let e of t)n?e.classList.remove("tooltip-show"):e.classList.add("tooltip-show");e.stopPropagation()}),document.getElementById("origMinPrice").innerText=r,document.getElementById("origMinPrice").style.visibility="hidden",document.getElementById("origMaxPrice").innerText=o,document.getElementById("origMaxPrice").style.visibility="hidden",document.getElementById("resetButton").addEventListener("click",()=>{document.getElementById("minPrice").value=r,document.getElementById("maxPrice").value=o,document.getElementById("minPrice").dispatchEvent(new Event("input")),document.getElementById("maxPrice").dispatchEvent(new Event("input")),document.getElementById("adjustmentSlider").value=3,document.getElementById("resetButton").style.visibility="hidden",s()}),document.getElementById("minPrice").addEventListener("blur",()=>s()),document.getElementById("minPrice").addEventListener("input",()=>{let e=document.getElementById("minPrice"),t=document.getElementById("maxPrice"),n=Number(e.value);n!==r?document.getElementById("origMinPrice").style.visibility="visible":document.getElementById("origMinPrice").style.visibility="hidden",m(r,o,e,t)}),document.getElementById("minIncrease").addEventListener("click",()=>{E(document.getElementById("minPrice"),r),analytics.track("Click",{elementID:"minIncrease"}),s()}),document.getElementById("minDecrease").addEventListener("click",()=>{v(document.getElementById("minPrice"),r),analytics.track("Click",{elementID:"minDecrease"}),s()}),document.getElementById("maxPrice").addEventListener("blur",()=>s()),document.getElementById("maxPrice").addEventListener("input",()=>{let e=document.getElementById("maxPrice"),t=document.getElementById("minPrice"),n=Number(e.value);n!==o?document.getElementById("origMaxPrice").style.visibility="visible":document.getElementById("origMaxPrice").style.visibility="hidden",m(r,o,t,e)}),document.getElementById("maxIncrease").addEventListener("click",()=>{E(document.getElementById("maxPrice"),o),analytics.track("Click",{elementID:"maxIncrease"}),s()}),document.getElementById("maxDecrease").addEventListener("click",()=>{v(document.getElementById("maxPrice"),o),analytics.track("Click",{elementID:"maxDecrease"}),s()}),(e.infoRequests?.price?.type==="Final Offer"||e.infoRequests?.price?.type==="Valuation")&&(document.getElementById("valuationMotivation").style.display="none")},f=async e=>{let t=await firebase.app().functions("europe-west1").httpsCallable("getItem")({itemId:e});return{...t?.data||{},id:e}},h=e=>e<500?.5*e:e<1e3?.4*e:.3*e,w=(e,t)=>Math.min(h(e),p(e,t)-e),b=async()=>{window.intercomSettings={app_id:"klyy0le5"},function(){var e=window,t=e.Intercom;if("function"==typeof t)t("reattach_activator"),t("update",e.intercomSettings);else{var n=document,i=function(){i.c(arguments)};i.q=[],i.c=function(e){i.q.push(e)},e.Intercom=i;var a=function(){var e=n.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://widget.intercom.io/widget/klyy0le5";var t=n.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)};e.attachEvent?e.attachEvent("onload",a):e.addEventListener("load",a,!1)}}(),Intercom("update",{hide_default_launcher:!0});let e=getParamsObject(),t=e.id?await f(e.id):JSON.parse(sessionStorage.getItem("itemToBeCreatedAfterSignIn")||"{}")?.item||JSON.parse(localStorage.getItem("latestItemCreated")||"{}");if(!t)return console.error("Invalid item id or no saved item to show valuation for"),location.href="/private";u(t),await B(t),triggerShowContent.click()};b()}();//# sourceMappingURL=itemValuation.js.map

//# sourceMappingURL=itemValuation.js.map
