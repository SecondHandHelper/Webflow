!function(e,t,n,l,o){var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i="function"==typeof r[l]&&r[l],a=i.cache||{},d="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function s(t,n){if(!a[t]){if(!e[t]){var o="function"==typeof r[l]&&r[l];if(!n&&o)return o(t,!0);if(i)return i(t,!0);if(d&&"string"==typeof t)return d(t);var c=Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}u.resolve=function(n){var l=e[t][1][n];return null!=l?l:n},u.cache={};var m=a[t]=new s.Module(t);e[t][0].call(m.exports,u,m,m.exports,this)}return a[t].exports;function u(e){var t=u.resolve(e);return!1===t?{}:s(t)}}s.isParcelRequire=!0,s.Module=function(e){this.id=e,this.bundle=s,this.exports={}},s.modules=e,s.cache=a,s.parent=i,s.register=function(t,n){e[t]=[function(e,t){t.exports=n},{}]},Object.defineProperty(s,"root",{get:function(){return r[l]}}),r[l]=s;for(var c=0;c<t.length;c++)s(t[c]);if(n){var m=s(n);"object"==typeof exports&&"undefined"!=typeof module?module.exports=m:"function"==typeof define&&define.amd?define(function(){return m}):o&&(this[o]=m)}}({"2mRjC":[function(e,t,n){if("true"===getParamsObject().createDrafts&&localStorage.getItem("lwlItemDrafts")&&(document.referrer.includes("sign-in")||document.referrer.includes("private"))){document.getElementsByClassName("div-block-230")[0].style.display="none",document.getElementById("header").style.display="none",document.getElementById("formDiv").style.display="none",document.getElementById("threadInputDiv").style.display="none",document.getElementById("lwlItemsDiv").style.display="none",document.getElementById("loadingDiv").style.display="flex";let e=JSON.parse(localStorage.getItem("lwlItemDrafts"));authUser.whenSet(async()=>{await Promise.all(e.map(e=>firebase.app().functions("europe-west1").httpsCallable("createItem")({id:e.id,item:e}))),localStorage.removeItem("lwlItemDrafts"),location.href="/private#wardrobe"})}let l=!1,o=e=>{document.getElementById("errorMessage").innerHTML=e||"Något gick fel, kontrollera att du skrivit in en giltig LWL tråd och försök igen.",document.getElementsByClassName("w-form-fail")[0].style.display="block",document.getElementById("lwlThreadUrl").style.display="block",document.getElementById("buttonsDiv").style.display="block",document.getElementById("doneButton").style.display="flex",document.getElementById("doneButton").innerText="Starta om",document.getElementById("introHeading").style.display="block",document.getElementById("scrapeProgressDiv").style.display="none",l=!1};document.getElementById("doneButton").addEventListener("click",()=>{if(l)return;document.getElementsByClassName("w-form-fail")[0].style.display="none";let e=document.getElementById("lwlThreadUrl");if(!e.value.length){console.log("No url thread given");return}if(!e.value.match(/^https:\/\/www.facebook.com\/groups\/982264948455365\/permalink\/\d+/)){o("Ogilitg LWL url angiven.");return}l=!0,document.getElementById("lwlThreadUrl").style.display="none",document.getElementById("buttonsDiv").style.display="none",document.getElementById("doneButton").style.display="none",document.getElementById("introHeading").style.display="none",document.getElementById("openIntroDiv").style.display="none",document.getElementById("scrapeProgressDiv").style.display="flex",document.getElementById("scrapeProgress").innerText="Startar...";let t=new WebSocket("wss://lwl-to-mai-heypmjzjfq-ey.a.run.app");t.addEventListener("open",()=>{console.log("connected to lwl thread scraping server"),t.send(JSON.stringify({url:e.value}))}),t.addEventListener("error",e=>{o(),t.close()}),t.addEventListener("message",async n=>{console.log("received message from server",n.data);let l=n.data;try{l=JSON.parse(n.data)}catch(e){l={status:"Startar..."}}if("Error"===l.status){o(l.data?.threadIsValid?"Något gick fel, försök gärna igen.":null),t.close();return}if("Item"===l.status&&l.data&&i(l.data),document.getElementById("scrapeProgress").innerText=l.status,l.status.match(/klar/i)){if(t.close(),document.getElementById("scrapeProgress").innerText="Skapar plaggen i Mai...",!l.data.length){o(),t.close();return}let n=await firebase.app().functions("europe-west3").httpsCallable("createItemDraftsFromLwl",{timeout:24e4})({itemData:l.data,url:e});authUser.current?location.href="/private#wardrobe":(document.getElementById("scrapeProgressDiv").style.display="none",document.getElementById("introHeading").innerText="Osålda plagg från din tråd. Logga in för att justera och sälja.",document.getElementById("introHeading").style.display="block",a(n.data),document.getElementById("buttonsDiv").style.display="block",document.getElementById("signInButton").style.display="flex",document.getElementById("signInButton").addEventListener("click",async()=>{localStorage.setItem("lwlItemDrafts",JSON.stringify(n.data)),location.href="/sign-in"}))}})});let r=!1,i=e=>{let t=document.getElementsByClassName("lwlitemcard")[0],n=document.getElementById("lwlItemList");r||(document.getElementById("lwlItemsDiv").style.display="block",n.innerHTML="",r=!0);let l=t.cloneNode(!0);l.classList.add("lwlItemCard");let o=e.images?.[0];o?(l.querySelector(".img-container").style.backgroundImage=`url("${o}")`,l.querySelector(".no-image-text").style.display="none",l.style.opacity="0.5"):l.querySelector(".img-container").style.display="none",l.querySelector(".lwl-item-title").innerText="",l.querySelector(".lwl-item-subtext").innerText="",n.appendChild(l)},a=e=>{for(let t of document.getElementsByClassName("lwlItemCard")){let n=t.getElementsByClassName("img-container")[0].style.backgroundImage.slice(4,-1).replaceAll(/"/g,""),l=e.find(e=>e.draftSourceProperties.rawData.images.includes(n));t.style.opacity="1",t.querySelector(".lwl-item-title").innerText=`${l.cleanedBrand||l.brand?.trim()}`,t.querySelector(".lwl-item-subtext").innerText=`${[l.category,l.maiSize].filter(e=>e).join(", ")}`}};document.getElementById("introNext").addEventListener("click",()=>{"Sätt igång"===document.getElementById("introNext").innerText&&(setCookie("lwlIntroSeen","true"),document.getElementById("introSection").style.display="none"),document.getElementById("introRightArrow").click(),document.querySelector(".w-slider-nav div:last-child").classList.contains("w-active")&&(document.getElementById("introNext").innerText="Sätt igång")}),document.getElementById("skipIntro").addEventListener("click",()=>{setCookie("lwlIntroSeen","true"),document.getElementById("introSection").style.display="none"}),"true"!==getCookie("lwlIntroSeen")&&(document.getElementById("introSection").style.display="flex"),document.getElementById("openIntroButton").addEventListener("click",()=>{document.getElementById("introSection").style.display="flex",document.querySelector(".slide-nav-lwl div.w-slider-dot").click(),document.getElementById("introNext").innerText="Nästa"}),document.getElementById("chatLink").addEventListener("click",()=>{Intercom("showNewMessage","Klistra in en länk till LWL tråden du försökte läsa in?\n\n")}),window.intercomSettings={app_id:"klyy0le5"},function(){var e=window,t=e.Intercom;if("function"==typeof t)t("reattach_activator"),t("update",e.intercomSettings);else{var n=document,l=function(){l.c(arguments)};l.q=[],l.c=function(e){l.q.push(e)},e.Intercom=l;var o=function(){var e=n.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://widget.intercom.io/widget/klyy0le5";var t=n.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)};e.attachEvent?e.attachEvent("onload",o):e.addEventListener("load",o,!1)}}()},{}]},["2mRjC"],"2mRjC","parcelRequire81ca");
//# sourceMappingURL=lwl.js.map
