{"mappings":"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","sources":["<anon>","editItem.js","sellItemHelpers.js"],"sourcesContent":["(function () {\nasync function $796bae1b0d1cb952$export$84f874cda6ebf2f2(input, fileName) {\n    if (!sessionStorage.getItem(\"newItemId\")) sessionStorage.setItem(\"newItemId\", await $796bae1b0d1cb952$export$70c624e1c153d1d3());\n    const tempId = sessionStorage.getItem(\"newItemId\");\n    let image = await $796bae1b0d1cb952$var$scaleImageToMaxSize(input);\n    if (!image) throw \"Fel vid bearbetning av vald bild.\";\n    const form = new FormData();\n    form.append(\"itemId\", tempId);\n    form.append(\"fileName\", fileName);\n    form.append(\"file\", image);\n    form.append(\"temporary\", \"true\");\n    form.append(\"generateSmallImage\", \"true\");\n    const response = await fetch(\"https://uploaditemimagebinary-heypmjzjfq-ew.a.run.app\", {\n        method: \"POST\",\n        body: form\n    });\n    return await response.json();\n}\nasync function $796bae1b0d1cb952$var$scaleImageToMaxSize(input) {\n    if (input.size < 9437184) // Don't compress images < 9MB in size\n    return Promise.resolve(input);\n    return new Promise((resolve, reject)=>{\n        const MAX_WIDTH = 1512;\n        const MAX_HEIGHT = 2016;\n        const reader = new FileReader();\n        reader.onload = ()=>{\n            const img = document.createElement(\"img\");\n            img.onload = ()=>{\n                let width = img.width;\n                let height = img.height;\n                if (width > height) {\n                    if (width > MAX_WIDTH) {\n                        height = height * (MAX_WIDTH / width);\n                        width = MAX_WIDTH;\n                    }\n                } else if (height > MAX_HEIGHT) {\n                    width = width * (MAX_HEIGHT / height);\n                    height = MAX_HEIGHT;\n                }\n                const canvas = document.createElement(\"canvas\");\n                canvas.width = width;\n                canvas.height = height;\n                const ctx = canvas.getContext(\"2d\");\n                ctx.imageSmoothingQuality = \"high\";\n                ctx.drawImage(img, 0, 0, width, height);\n                canvas.toBlob(resolve, \"image/jpeg\");\n            };\n            img.src = reader.result;\n            reader.onerror = reject;\n        };\n        reader.readAsDataURL(input);\n    });\n}\nasync function $796bae1b0d1cb952$export$70c624e1c153d1d3() {\n    const endpointUrl = \"https://generateuniqueid-heypmjzjfq-ew.a.run.app\";\n    try {\n        const response = await fetch(endpointUrl, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\"\n            }\n        });\n        if (!response.ok) {\n            console.error(`Error: ${response.statusText}`);\n            return null;\n        }\n        const data = await response.json();\n        return data.id;\n    } catch (error) {\n        console.error(`Failed to fetch unique ID, generating uuidv4 id: ${error.message}`, error);\n        return uuidv4();\n    }\n}\nasync function $796bae1b0d1cb952$export$ace0eeb8d81a6535(imageUrl, saveState = true) {\n    const enhancedImageUrls = await $796bae1b0d1cb952$var$createEnhancedImage(imageUrl);\n    if (enhancedImageUrls?.url) {\n        if (saveState) $796bae1b0d1cb952$export$103dee3750c6df19(\"enhancedFrontImage\", enhancedImageUrls.url, enhancedImageUrls.urlSmall);\n        $796bae1b0d1cb952$export$3fb7c784498eae74(\"frontImage\", window.innerWidth <= 400 ? enhancedImageUrls.urlSmall : enhancedImageUrls.url);\n    }\n    $796bae1b0d1cb952$export$f4e19468e22ee9d3(\"frontImage\");\n    return enhancedImageUrls;\n}\nasync function $796bae1b0d1cb952$var$createEnhancedImage(imageUrl) {\n    try {\n        const response = await firebase.app().functions(\"europe-west1\").httpsCallable(\"enhanceFrontImage\")({\n            imageUrl: imageUrl\n        });\n        sessionStorage.setItem(\"enhancedFrontImage\", response.data.url);\n        return response.data;\n    } catch (ex) {\n        errorHandler.report(ex);\n        console.error(ex);\n        return \"\";\n    }\n}\nfunction $796bae1b0d1cb952$export$f4e19468e22ee9d3(imageName) {\n    document.getElementById(`loading${$796bae1b0d1cb952$export$d07f57595c356899(imageName)}Icon`).style.display = \"none\";\n    document.getElementById(`delete${$796bae1b0d1cb952$export$d07f57595c356899(imageName)}Icon`).style.display = \"inline-block\";\n    if (imageName === \"frontImage\") document.getElementById(\"enhancedAnimationDiv\").style.display = \"none\";\n}\nfunction $796bae1b0d1cb952$export$103dee3750c6df19(imageName, imageUrl, imageUrlSmall) {\n    let newItem = JSON.parse(localStorage.getItem(\"newItem\") || JSON.stringify({}));\n    const images = newItem.images || {};\n    images[imageName] = imageUrl;\n    images[`${imageName}Small`] = imageUrlSmall;\n    newItem.images = images;\n    localStorage.setItem(\"newItem\", JSON.stringify(newItem));\n}\nfunction $796bae1b0d1cb952$export$3fb7c784498eae74(imageName, url) {\n    document.getElementById(`${imageName}Preview`).style.backgroundImage = `url('${url}')`;\n    $796bae1b0d1cb952$export$f4e19468e22ee9d3(imageName);\n}\nfunction $796bae1b0d1cb952$export$d07f57595c356899(string) {\n    return string.charAt(0).toUpperCase() + string.slice(1);\n}\nasync function $796bae1b0d1cb952$export$16814c2c31118a6e(input, imageName, saveState = true) {\n    try {\n        $796bae1b0d1cb952$var$hideImageError(imageName);\n        let src = URL.createObjectURL(input);\n        document.getElementById(`${imageName}PreviewUploading`).style.backgroundImage = `url('${src}')`;\n        document.getElementById(`${imageName}Preview`).style.backgroundImage = `url('${src}')`;\n        $796bae1b0d1cb952$export$484d223052d7ce8a(imageName);\n        $796bae1b0d1cb952$export$b8d427576f438d88(imageName, \"success-state\");\n        const { url: imageUrl, urlSmall: imageUrlSmall } = await $796bae1b0d1cb952$export$84f874cda6ebf2f2(input, imageName);\n        if (saveState) $796bae1b0d1cb952$export$103dee3750c6df19(imageName, imageUrl, imageUrlSmall);\n        return imageUrl;\n    } catch (ex) {\n        console.error(\"Failed to upload image\", ex);\n        errorHandler.report(ex);\n        document.getElementById(`${imageName}PreviewUploading`).style.backgroundImage = \"\";\n        document.getElementById(`${imageName}Preview`).style.backgroundImage = \"\";\n        document.getElementById(`loading${$796bae1b0d1cb952$export$d07f57595c356899(imageName)}Icon`).style.display = \"none\";\n        $796bae1b0d1cb952$export$b8d427576f438d88(imageName, \"default-state\");\n        if (input.size > 10485760) $796bae1b0d1cb952$var$showImageError(imageName, \"Error: Bilden \\xe4r f\\xf6r stor. Max 10 MB.\");\n        else $796bae1b0d1cb952$var$showImageError(imageName, \"Error: N\\xe5got gick fel vid uppladdning, f\\xf6rs\\xf6k igen eller kontakt oss om felet kvarst\\xe5r.\");\n        document.getElementById(imageName).value = \"\";\n    }\n}\nfunction $796bae1b0d1cb952$var$showImageError(imageName, error) {\n    const parentNode = document.getElementById(imageName).parentNode.parentNode;\n    parentNode.querySelector(\".w-file-upload-error\").style.display = \"block\";\n    parentNode.querySelector(\".w-file-upload-error-msg\").innerText = error;\n}\nfunction $796bae1b0d1cb952$var$hideImageError(imageName) {\n    const parentNode = document.getElementById(imageName).parentNode.parentNode;\n    parentNode.querySelector(\".w-file-upload-error\").style.display = \"none\";\n}\nfunction $796bae1b0d1cb952$export$b8d427576f438d88(imageName, state) {\n    const siblings = document.getElementById(imageName).parentNode.parentNode.childNodes;\n    for(let i = 0; i < siblings.length; i++)if (siblings[i].className.includes(state)) siblings[i].style.display = \"block\";\n    else // Hide other states of file input field \"empty-state\" and \"error-state\"\n    siblings[i].style.display = \"none\";\n}\nfunction $796bae1b0d1cb952$export$484d223052d7ce8a(imageName) {\n    if (imageName === \"frontImage\") {\n        document.getElementById(`delete${$796bae1b0d1cb952$export$d07f57595c356899(imageName)}Icon`).style.display = \"none\";\n        document.getElementById(\"enhancedAnimationDiv\").style.display = \"block\";\n        triggerEnhancingAnimation.click();\n        return;\n    }\n    document.getElementById(`loading${$796bae1b0d1cb952$export$d07f57595c356899(imageName)}Icon`).style.display = \"inline-block\";\n    document.getElementById(`delete${$796bae1b0d1cb952$export$d07f57595c356899(imageName)}Icon`).style.display = \"none\";\n}\n\n\nasync function $c6d2db474a2e3f49$var$updateItem(itemId, changedImages) {\n    console.log(\"updateItem()\");\n    $(\".goback\").data(\"disabled\", true);\n    const now = new Date();\n    const size = itemSize.value;\n    const material = itemMaterial.value;\n    const brand = itemBrand.value;\n    const model = itemModel.value;\n    const originalPrice = Number(itemOriginalPrice.value);\n    const age = itemAge.value;\n    const condition = itemCondition.value;\n    const defectDescription = itemDefectDescription.value;\n    const userComment = itemUserComment.value;\n    let changes = {\n        updatedAt: now,\n        size: size,\n        material: material,\n        brand: brand,\n        model: model,\n        originalPrice: originalPrice,\n        age: age,\n        condition: condition,\n        defectDescription: defectDescription,\n        userComment: userComment\n    };\n    async function uploadImages(itemId) {\n        if (changedImages.length > 0) {\n            // START - Mark imageRequest as Resolved\n            await db.collection(\"items\").doc(itemId).get().then((doc)=>{\n                if (doc.data()?.infoRequests?.images?.status === \"Active\") changes[\"infoRequests.images.status\"] = \"Resolved\";\n            });\n            // END - Mark imageRequest as Resolved\n            let elements = changedImages;\n            let images = new Map(); //Gather files from the form in a map \"Images\"\n            elements.forEach((element)=>{\n                if (document.getElementById(element).files[0]) {\n                    let file = document.getElementById(element).files[0];\n                    images.set(element, file);\n                }\n            });\n            // Uploads files and add the new imageUrls to the changes object\n            await Promise.all(Array.from(images).map(async ([imageName, value])=>{\n                console.log(`${imageName}: ${value}`);\n                // If images was changed, set photo directions to default, since an 'info request' of images could have been shown\n                photoDirectionsText.style.display = \"block\";\n                infoRequestImagesDiv.style.display = \"none\";\n                const { url: imageUrl } = await (0, $796bae1b0d1cb952$export$84f874cda6ebf2f2)(value, imageName);\n                await firebase.app().functions(\"europe-west1\").httpsCallable(\"saveItemImage\")({\n                    itemId: itemId,\n                    fileName: imageName,\n                    url: imageUrl\n                });\n            }));\n            if (changedImages.indexOf(\"frontImage\") > -1) {\n                // Front image was changed, also save the enhancedFrontImage in the right place\n                const item = await firebase.app().functions(\"europe-west1\").httpsCallable(\"getItem\")({\n                    itemId: itemId\n                });\n                const itemData = item.data;\n                await firebase.app().functions(\"europe-west1\").httpsCallable(\"saveItemImage\")({\n                    itemId: itemId,\n                    fileName: `enhancedFrontImage`,\n                    url: `${sessionStorage.getItem(\"enhancedFrontImage\")}`\n                });\n                changes[`images.versionsStatus.enhancedFrontImage`] = \"\";\n                if (itemData.images.coverImage === itemData.images.enhancedFrontImage) {\n                    changes[\"images.coverImage\"] = \"\";\n                    changes[\"images.coverImageSmall\"] = \"\";\n                    changes[\"images.coverImageMedium\"] = \"\";\n                    changes[\"images.coverImageLarge\"] = \"\";\n                    changes[`images.versionsStatus.coverImage`] = \"\";\n                }\n            }\n        }\n        await updateItemDoc(itemId, changes);\n        sessionStorage.removeItem(\"enhancedFrontImage\");\n    }\n    async function updateItemDoc(itemId, changes) {\n        console.log(\"updateItemDoc()\");\n        // Update item in FS without the images first, only because that's how I did it when adding an item.\n        console.log(\"CHANGES: \", changes);\n        const itemRef = db.collection(\"items\").doc(itemId);\n        const res = await itemRef.update(changes).then((itemRef)=>{\n            console.log(\"Document updated with ID: \", itemId);\n            saveChangesButtonText.style.color = \"#7a7575\";\n            saveChangesButtonText.innerHTML = \"Sparat\";\n        }).catch((error)=>{\n            errorHandler.report(error);\n            console.error(\"Error adding document: \", error);\n        });\n    }\n    await uploadImages(itemId);\n    $(\".goback\").data(\"disabled\", false);\n}\nasync function $c6d2db474a2e3f49$var$fillForm(itemId) {\n    try {\n        const userId = authUser.current.uid;\n        const item = await firebase.app().functions(\"europe-west1\").httpsCallable(\"getItem\")({\n            itemId: itemId\n        });\n        const data = item.data;\n        if (userId === data.user || userId === \"3OkW5av20HP8ScpUDS8ip9fBEZr1\") {\n            console.log(\"Item data:\", data);\n            const sex = data.sex;\n            const size = data.size;\n            const material = data.material;\n            const brand = data.brand;\n            const model = data.model;\n            let originalPrice = data.originalPrice;\n            if (originalPrice <= 0) originalPrice = null;\n            const age = data.age;\n            const condition = data.condition;\n            const defects = data.defects;\n            const defectDescription = data.defectDescription;\n            const noSmoke = data.noSmoke;\n            const noAnimals = data.noAnimals;\n            const userComment = data.userComment;\n            const infoRequests = data.infoRequests;\n            const images = data.images;\n            const status = data.status;\n            let category = \"\";\n            if (data.category) category = data.category;\n            // Populate images\n            function showImageAndHideSiblings(x, url) {\n                document.getElementById(`${x}Preview`).style.backgroundImage = `url('${url}')`;\n                const siblings = document.getElementById(x).parentNode.parentNode.childNodes;\n                for(let i = 0; i < siblings.length; i++)if (siblings[i].className.includes(\"success-state\")) siblings[i].style.display = \"block\";\n                else siblings[i].style.display = \"none\";\n            }\n            for(const x in images){\n                const possibleElmts = [\n                    \"brandTagImage\",\n                    \"materialTagImage\",\n                    \"defectImage\",\n                    \"productImage\",\n                    \"extraImage\"\n                ];\n                const url = images[`${x}Small`] || images[`${x}Medium`] || images[`${x}Large`] || images[x];\n                if (possibleElmts.includes(x)) showImageAndHideSiblings(x, url);\n            }\n            // Special case for frontImage where we want to show the enhancedFrontImage\n            const frontImageUrl = images[`enhancedFrontImageSmall`] || images[`enhancedFrontImageMedium`] || images[`enhancedFrontImageLarge`] || images[\"enhancedFrontImage\"] || images[`frontImageSmall`] || images[`frontImageMedium`] || images[`frontImageLarge`] || images[\"frontImage\"];\n            if (frontImageUrl) showImageAndHideSiblings(\"frontImage\", frontImageUrl);\n            // Populate text input fields\n            pageTitle.innerHTML = brand;\n            pageSubTitle.innerHTML = category;\n            itemSize.setAttribute(\"value\", size);\n            itemBrand.setAttribute(\"value\", brand);\n            itemMaterial.setAttribute(\"value\", material);\n            itemModel.setAttribute(\"value\", model);\n            itemOriginalPrice.setAttribute(\"value\", originalPrice);\n            itemUserComment.value = userComment; //Textarea\n            itemDefectDescription.value = defectDescription; //Textarea\n            // Populate select fields\n            let options = itemAge.options;\n            for(let i = 0; i < options.length; i++)if (age === options[i].attributes.value.value) {\n                itemAge.selectedIndex = i;\n                if (age !== \"\") itemAge.style.color = \"#333\";\n            }\n            options = itemCondition.options;\n            for(let i = 0; i < options.length; i++)if (condition === options[i].innerText) {\n                itemCondition.selectedIndex = i;\n                itemCondition.style.color = \"#333\";\n                if (options[i].innerText === \"Anv\\xe4nd, tecken p\\xe5 slitage\") defectInfoDiv.style.display = \"block\";\n            }\n            // Populate checkboxes and readio-buttons is harder to do with Webflow, so not allowing users to change defects right now\n            // If \"info request\" for images exist, show the directions\n            if (infoRequests?.images?.status === \"Active\" && infoRequests?.images?.description) {\n                photoDirectionsText.style.display = \"none\";\n                infoRequestImagesText.innerHTML = infoRequests.images.description;\n                infoRequestImagesDiv.style.display = \"flex\";\n            }\n            // Show form\n            updateItemFormDiv.style.display = \"block\";\n            pageTitleDiv.style.display = \"flex\";\n            loadingDiv.style.display = \"none\";\n        }\n    } catch (error) {\n        errorHandler.report(error);\n        console.log(\"Error getting item document:\", error);\n    }\n}\nasync function $c6d2db474a2e3f49$var$saveChanges() {\n    saveChangesButtonText.style.color = \"#e2dede\";\n    console.log(\"changedImages: \", $c6d2db474a2e3f49$var$changedImages);\n    await $c6d2db474a2e3f49$var$updateItem(params.id, $c6d2db474a2e3f49$var$changedImages);\n}\nfunction $c6d2db474a2e3f49$var$setUpEventListeners() {\n    // EVENT LISTENERS\n    let imageElementIds = [\n        \"frontImage\",\n        \"brandTagImage\",\n        \"materialTagImage\",\n        \"productImage\",\n        \"defectImage\",\n        \"extraImage\"\n    ];\n    imageElementIds.forEach(function(id) {\n        let elemUpload = document.getElementById(id);\n        let elemPreviewUploading = document.getElementById(`${id}PreviewUploading`);\n        let elemPreview = document.getElementById(`${id}Preview`);\n        elemUpload.addEventListener(\"change\", function() {\n            let input = this.files[0];\n            if (input) {\n                let src = URL.createObjectURL(input);\n                elemPreviewUploading.style.backgroundImage = `url('${src}')`;\n                elemPreview.style.backgroundImage = `url('${src}')`;\n            }\n        });\n    });\n    document.getElementById(\"frontImage\").addEventListener(\"change\", async function() {\n        let input = this.files[0];\n        if (input) {\n            const imageUrl = await (0, $796bae1b0d1cb952$export$16814c2c31118a6e)(input, \"frontImage\", false);\n            if (!imageUrl || Object.keys(imageUrl).length === 0) return;\n            await (0, $796bae1b0d1cb952$export$ace0eeb8d81a6535)(imageUrl, false);\n        }\n    });\n    let elementsArray = document.querySelectorAll(\"input\");\n    elementsArray.forEach(function(elem) {\n        elem.addEventListener(\"input\", function() {\n            saveChangesButtonText.style.color = \"#c24700\";\n            saveChangesButtonText.innerHTML = \"Spara\";\n            if (elem.id.includes(\"Image\")) $c6d2db474a2e3f49$var$changedImages.push(elem.id);\n        });\n    });\n    itemCondition.onchange = function() {\n        let input = this.value;\n        if (input == \"Anv\\xe4nd, tecken p\\xe5 slitage\") {\n            defectInfoDiv.style.display = \"block\";\n            itemCondition.style.color = \"#333\";\n        } else if (input == \"\") {\n            defectInfoDiv.style.display = \"none\";\n            itemCondition.style.color = \"#929292\";\n        } else {\n            defectInfoDiv.style.display = \"none\";\n            itemCondition.style.color = \"#333\";\n        }\n    };\n    itemAge.onchange = function() {\n        let input = this.value;\n        if (input != \"\") itemAge.style.color = \"#333\";\n        else itemAge.style.color = \"#929292\";\n    };\n    saveChangesButton.addEventListener(\"click\", $c6d2db474a2e3f49$var$saveChanges);\n}\nlet $c6d2db474a2e3f49$var$changedImages = [];\nsessionStorage.removeItem(\"enhancedFrontImage\");\n$c6d2db474a2e3f49$var$setUpEventListeners();\nuser.whenSet(async ()=>await $c6d2db474a2e3f49$var$fillForm(params.id));\nautocomplete(document.getElementById(\"itemBrand\"), brands); // Enable autocomplete\n\n})();\n//# sourceMappingURL=editItem.js.map\n","import { enhanceFrontImage, uploadImageAndShowPreview, uploadTempImage } from \"./sellItemHelpers\";\n\nasync function updateItem(itemId, changedImages) {\n    console.log(\"updateItem()\");\n    $('.goback').data('disabled', true);\n    const now = new Date();\n    const size = itemSize.value;\n    const material = itemMaterial.value;\n    const brand = itemBrand.value;\n    const model = itemModel.value;\n    const originalPrice = Number(itemOriginalPrice.value);\n    const age = itemAge.value;\n    const condition = itemCondition.value;\n    const defectDescription = itemDefectDescription.value;\n    const userComment = itemUserComment.value;\n    let changes = {\n      updatedAt: now,\n      size: size,\n      material: material,\n      brand: brand,\n      model: model,\n      originalPrice: originalPrice,\n      age: age,\n      condition: condition,\n      defectDescription: defectDescription,\n      userComment: userComment\n    }\n  \n    async function uploadImages(itemId) {\n      if (changedImages.length > 0) {\n        // START - Mark imageRequest as Resolved\n        await db.collection(\"items\").doc(itemId).get().then((doc) => {\n          if (doc.data()?.infoRequests?.images?.status === \"Active\") {\n            changes[\"infoRequests.images.status\"] = \"Resolved\";\n          }\n        });\n        // END - Mark imageRequest as Resolved\n        let elements = changedImages;\n        let images = new Map(); //Gather files from the form in a map \"Images\"\n        elements.forEach(element => {\n          if (document.getElementById(element).files[0]) {\n            let file = document.getElementById(element).files[0];\n            images.set(element, file);\n          }\n        });\n        // Uploads files and add the new imageUrls to the changes object\n        await Promise.all(Array.from(images).map(async ([imageName, value]) => {\n          console.log(`${imageName}: ${value}`);\n          // If images was changed, set photo directions to default, since an 'info request' of images could have been shown\n          photoDirectionsText.style.display = 'block';\n          infoRequestImagesDiv.style.display = 'none';\n          const { url: imageUrl } = await uploadTempImage(value, imageName);\n          await firebase.app().functions(\"europe-west1\").httpsCallable('saveItemImage')({ itemId, fileName: imageName, url: imageUrl });\n        }));\n        if (changedImages.indexOf('frontImage') > -1) {\n          // Front image was changed, also save the enhancedFrontImage in the right place\n          const item = await firebase.app().functions(\"europe-west1\").httpsCallable('getItem')({itemId})\n          const itemData = item.data;\n          await firebase.app().functions(\"europe-west1\").httpsCallable('saveItemImage')({ itemId, fileName: `enhancedFrontImage`,\n            url: `${sessionStorage.getItem('enhancedFrontImage')}` });\n          changes[`images.versionsStatus.enhancedFrontImage`] = '';\n          if (itemData.images.coverImage === itemData.images.enhancedFrontImage) {\n              changes['images.coverImage'] = '';\n              changes['images.coverImageSmall'] = '';\n              changes['images.coverImageMedium'] = '';\n              changes['images.coverImageLarge'] = '';\n              changes[`images.versionsStatus.coverImage`] = '';\n          }\n        }\n      }\n      await updateItemDoc(itemId, changes);\n      sessionStorage.removeItem('enhancedFrontImage');\n    }\n  \n    async function updateItemDoc(itemId, changes) {\n      console.log(\"updateItemDoc()\");\n      // Update item in FS without the images first, only because that's how I did it when adding an item.\n      console.log(\"CHANGES: \", changes);\n      const itemRef = db.collection('items').doc(itemId);\n      const res = await itemRef.update(changes)\n        .then((itemRef) => {\n          console.log(\"Document updated with ID: \", itemId);\n          saveChangesButtonText.style.color = \"#7a7575\";\n          saveChangesButtonText.innerHTML = \"Sparat\";\n        })\n        .catch((error) => {\n          errorHandler.report(error);\n          console.error(\"Error adding document: \", error);\n        });\n    }\n  \n    await uploadImages(itemId);\n    $('.goback').data('disabled', false);\n}\n\nasync function fillForm(itemId) {\n    try {\n        const userId = authUser.current.uid;\n        const item = await firebase.app().functions(\"europe-west1\").httpsCallable('getItem')({itemId})\n        const data = item.data;\n        if (userId === data.user || userId === '3OkW5av20HP8ScpUDS8ip9fBEZr1') {\n            console.log(\"Item data:\", data);\n            const sex = data.sex;\n            const size = data.size;\n            const material = data.material;\n            const brand = data.brand;\n            const model = data.model;\n            let originalPrice = data.originalPrice;\n            if (originalPrice <= 0) {\n                originalPrice = null;\n            }\n            const age = data.age;\n            const condition = data.condition;\n            const defects = data.defects;\n            const defectDescription = data.defectDescription;\n            const noSmoke = data.noSmoke;\n            const noAnimals = data.noAnimals;\n            const userComment = data.userComment;\n            const infoRequests = data.infoRequests;\n            const images = data.images;\n            const status = data.status;\n            let category = \"\";\n            if (data.category) {\n                category = data.category;\n            }\n\n            // Populate images\n            function showImageAndHideSiblings(x, url) {\n                document.getElementById(`${x}Preview`).style.backgroundImage = `url('${url}')`;\n                const siblings = document.getElementById(x).parentNode.parentNode.childNodes;\n                for (let i = 0; i < siblings.length; i++) {\n                    if (siblings[i].className.includes(\"success-state\")) {\n                        siblings[i].style.display = 'block';\n                    } else {\n                        siblings[i].style.display = 'none';\n                    }\n                }\n            }\n\n            for (const x in images) {\n                const possibleElmts = [\"brandTagImage\", \"materialTagImage\", \"defectImage\", \"productImage\", \"extraImage\"];\n                const url = images[`${x}Small`] || images[`${x}Medium`] || images[`${x}Large`] || images[x];\n                if (possibleElmts.includes(x)) {\n                    showImageAndHideSiblings(x, url);\n                }\n            }\n            // Special case for frontImage where we want to show the enhancedFrontImage\n            const frontImageUrl = images[`enhancedFrontImageSmall`] || images[`enhancedFrontImageMedium`] || images[`enhancedFrontImageLarge`] || images['enhancedFrontImage'] ||\n                images[`frontImageSmall`] || images[`frontImageMedium`] || images[`frontImageLarge`] || images['frontImage'];\n            if (frontImageUrl) {\n                showImageAndHideSiblings('frontImage', frontImageUrl);\n            }\n\n            // Populate text input fields\n            pageTitle.innerHTML = brand;\n            pageSubTitle.innerHTML = category;\n            itemSize.setAttribute('value', size);\n            itemBrand.setAttribute('value', brand);\n            itemMaterial.setAttribute('value', material);\n            itemModel.setAttribute('value', model);\n            itemOriginalPrice.setAttribute('value', originalPrice);\n            itemUserComment.value = userComment; //Textarea\n            itemDefectDescription.value = defectDescription; //Textarea\n\n            // Populate select fields\n            let options = itemAge.options;\n            for (let i = 0; i < options.length; i++) {\n                if (age === options[i].attributes.value.value) {\n                    itemAge.selectedIndex = i;\n                    if (age !== \"\") {\n                        itemAge.style.color = \"#333\";\n                    }\n                }\n            }\n            options = itemCondition.options;\n            for (let i = 0; i < options.length; i++) {\n                if (condition === options[i].innerText) {\n                    itemCondition.selectedIndex = i;\n                    itemCondition.style.color = \"#333\";\n                    if (options[i].innerText === \"Använd, tecken på slitage\") {\n                        defectInfoDiv.style.display = 'block';\n                    }\n                }\n            }\n\n            // Populate checkboxes and readio-buttons is harder to do with Webflow, so not allowing users to change defects right now\n\n            // If \"info request\" for images exist, show the directions\n            if (infoRequests?.images?.status === \"Active\" && infoRequests?.images?.description) {\n                photoDirectionsText.style.display = 'none';\n                infoRequestImagesText.innerHTML = infoRequests.images.description;\n                infoRequestImagesDiv.style.display = 'flex';\n            }\n\n            // Show form\n            updateItemFormDiv.style.display = \"block\";\n            pageTitleDiv.style.display = \"flex\";\n            loadingDiv.style.display = \"none\";\n        }\n    } catch (error) {\n        errorHandler.report(error);\n        console.log(\"Error getting item document:\", error);\n    }\n}\n\nasync function saveChanges() {\n    saveChangesButtonText.style.color = \"#e2dede\";\n    console.log(\"changedImages: \", changedImages);\n    await updateItem(params.id, changedImages);\n}\n\nfunction setUpEventListeners() {\n    // EVENT LISTENERS\n    let imageElementIds = ['frontImage', 'brandTagImage', 'materialTagImage', 'productImage', 'defectImage', 'extraImage'];\n    imageElementIds.forEach(function (id) {\n        let elemUpload = document.getElementById(id);\n        let elemPreviewUploading = document.getElementById(`${id}PreviewUploading`);\n        let elemPreview = document.getElementById(`${id}Preview`);\n        elemUpload.addEventListener(\"change\", function () {\n            let input = this.files[0];\n            if (input) {\n                let src = URL.createObjectURL(input);\n                elemPreviewUploading.style.backgroundImage = `url('${src}')`;\n                elemPreview.style.backgroundImage = `url('${src}')`;\n            }\n        });\n    });\n    document.getElementById('frontImage').addEventListener('change', async function () {\n        let input = this.files[0];\n        if (input) {\n            const imageUrl = await uploadImageAndShowPreview(input, 'frontImage', false);\n            if (!imageUrl || Object.keys(imageUrl).length === 0) {\n                return;\n            }\n            await enhanceFrontImage(imageUrl, false);\n        }\n    });\n\n    let elementsArray = document.querySelectorAll(\"input\");\n    elementsArray.forEach(function (elem) {\n        elem.addEventListener(\"input\", function () {\n            saveChangesButtonText.style.color = \"#c24700\";\n            saveChangesButtonText.innerHTML = \"Spara\";\n            if (elem.id.includes(\"Image\")) {\n                changedImages.push(elem.id);\n            }\n        });\n    });\n\n    itemCondition.onchange = function () {\n        let input = this.value;\n        if (input == \"Använd, tecken på slitage\") {\n            defectInfoDiv.style.display = 'block';\n            itemCondition.style.color = \"#333\";\n        } else if (input == \"\") {\n            defectInfoDiv.style.display = 'none';\n            itemCondition.style.color = \"#929292\";\n        } else {\n            defectInfoDiv.style.display = 'none';\n            itemCondition.style.color = \"#333\";\n        }\n    };\n\n    itemAge.onchange = function () {\n        let input = this.value;\n        if (input != \"\") {\n            itemAge.style.color = \"#333\";\n        } else {\n            itemAge.style.color = \"#929292\";\n        }\n    };\n\n    saveChangesButton.addEventListener('click', saveChanges);\n}\n\nlet changedImages = [];\nsessionStorage.removeItem('enhancedFrontImage');\nsetUpEventListeners();\nuser.whenSet(async () => await fillForm(params.id));\nautocomplete(document.getElementById(\"itemBrand\"), brands); // Enable autocomplete\n","export async function uploadTempImage(input, fileName) {\n    if (!sessionStorage.getItem('newItemId')) {\n        sessionStorage.setItem('newItemId', await  requestUniqueId());\n    }\n    const tempId = sessionStorage.getItem('newItemId');\n    let image = await scaleImageToMaxSize(input);\n    if (!image) {\n        throw 'Fel vid bearbetning av vald bild.';\n    }\n    const form = new FormData();\n    form.append('itemId', tempId);\n    form.append('fileName', fileName);\n    form.append('file', image);\n    form.append('temporary', 'true');\n    form.append('generateSmallImage', 'true');\n    const response = await fetch('https://uploaditemimagebinary-heypmjzjfq-ew.a.run.app', {\n        method: 'POST',\n        body: form\n    });\n    return await response.json();\n}\n\nasync function scaleImageToMaxSize(input) {\n    if (input.size < 9 * 1024 * 1024) {\n        // Don't compress images < 9MB in size\n        return Promise.resolve(input);\n    }\n    return new Promise((resolve, reject) => {\n        const MAX_WIDTH = 1512;\n        const MAX_HEIGHT = 2016;\n        const reader = new FileReader();\n        reader.onload = () => {\n            const img = document.createElement(\"img\");\n            img.onload = () => {\n                let width = img.width;\n                let height = img.height;\n                if (width > height) {\n                    if (width > MAX_WIDTH) {\n                        height = height * (MAX_WIDTH / width);\n                        width = MAX_WIDTH;\n                    }\n                } else {\n                    if (height > MAX_HEIGHT) {\n                        width = width * (MAX_HEIGHT / height);\n                        height = MAX_HEIGHT;\n                    }\n                }\n                const canvas = document.createElement(\"canvas\");\n                canvas.width = width;\n                canvas.height = height;\n                const ctx = canvas.getContext(\"2d\");\n                ctx.imageSmoothingQuality = \"high\";\n                ctx.drawImage(img, 0, 0, width, height);\n                canvas.toBlob(resolve, 'image/jpeg')\n            }\n            img.src = reader.result;\n            reader.onerror = reject;\n        }\n        reader.readAsDataURL(input);\n    });\n}\n\nexport async function requestUniqueId() {\n    const endpointUrl = 'https://generateuniqueid-heypmjzjfq-ew.a.run.app';\n    try {\n        const response = await fetch(endpointUrl, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n        });\n        if (!response.ok) {\n            console.error(`Error: ${response.statusText}`);\n            return null;\n        }\n        const data = await response.json();\n        return data.id;\n    } catch (error) {\n        console.error(`Failed to fetch unique ID, generating uuidv4 id: ${error.message}`, error);\n        return uuidv4();\n    }\n}\n\nexport async function enhanceFrontImage(imageUrl, saveState = true) {\n    const enhancedImageUrls = await createEnhancedImage(imageUrl);\n    if (enhancedImageUrls?.url) {\n        if (saveState) {\n            rememberNewItemImageField('enhancedFrontImage', enhancedImageUrls.url, enhancedImageUrls.urlSmall);\n        }\n        showImagePreview('frontImage', window.innerWidth <= 400 ? enhancedImageUrls.urlSmall : enhancedImageUrls.url);\n    }\n    showDeleteImageIcon('frontImage');\n    return enhancedImageUrls;\n}\n\nasync function createEnhancedImage(imageUrl) {\n    try {\n        const response = await firebase.app().functions(\"europe-west1\").httpsCallable('enhanceFrontImage')({ imageUrl });\n        sessionStorage.setItem('enhancedFrontImage', response.data.url)\n        return response.data;\n    } catch (ex) {\n        errorHandler.report(ex);\n        console.error(ex);\n        return '';\n    }\n}\n\nexport function showDeleteImageIcon(imageName) {\n    document.getElementById(`loading${capitalizeFirstLetter(imageName)}Icon`).style.display = 'none';\n    document.getElementById(`delete${capitalizeFirstLetter(imageName)}Icon`).style.display = 'inline-block';\n    if (imageName === 'frontImage'){\n        document.getElementById('enhancedAnimationDiv').style.display = 'none';\n    }\n}\n\nexport function rememberNewItemImageField(imageName, imageUrl, imageUrlSmall) {\n    let newItem = JSON.parse(localStorage.getItem('newItem') || JSON.stringify({}));\n    const images = newItem.images || {};\n    images[imageName] = imageUrl;\n    images[`${imageName}Small`] = imageUrlSmall;\n    newItem.images = images;\n    localStorage.setItem('newItem', JSON.stringify(newItem));\n}\n\nexport function showImagePreview(imageName, url) {\n    document.getElementById(`${imageName}Preview`).style.backgroundImage = `url('${url}')`;\n    showDeleteImageIcon(imageName);\n}\n\nexport function capitalizeFirstLetter(string) {\n    return string.charAt(0).toUpperCase() + string.slice(1);\n}\n\nexport async function uploadImageAndShowPreview(input, imageName, saveState = true) {\n    try {\n        hideImageError(imageName);\n        let src = URL.createObjectURL(input);\n        document.getElementById(`${imageName}PreviewUploading`).style.backgroundImage = `url('${src}')`;\n        document.getElementById(`${imageName}Preview`).style.backgroundImage = `url('${src}')`;\n        showLoadingIcon(imageName)\n        showImageState(imageName, 'success-state');\n        const { url: imageUrl, urlSmall: imageUrlSmall } = await uploadTempImage(input, imageName);\n        if (saveState) {\n            rememberNewItemImageField(imageName, imageUrl, imageUrlSmall);\n        }\n        return imageUrl;\n    } catch (ex) {\n        console.error('Failed to upload image', ex);\n        errorHandler.report(ex);\n        document.getElementById(`${imageName}PreviewUploading`).style.backgroundImage = '';\n        document.getElementById(`${imageName}Preview`).style.backgroundImage = '';\n        document.getElementById(`loading${capitalizeFirstLetter(imageName)}Icon`).style.display = 'none';\n        showImageState(imageName, 'default-state');\n        if (input.size > 10 * 1024 * 1024) {\n            showImageError(imageName, 'Error: Bilden är för stor. Max 10 MB.');\n        } else {\n            showImageError(imageName, 'Error: Något gick fel vid uppladdning, försök igen eller kontakt oss om felet kvarstår.');\n        }\n        document.getElementById(imageName).value = '';\n    }\n}\n\nfunction showImageError(imageName, error) {\n    const parentNode = document.getElementById(imageName).parentNode.parentNode;\n    parentNode.querySelector('.w-file-upload-error').style.display = 'block';\n    parentNode.querySelector('.w-file-upload-error-msg').innerText = error;\n}\n\nfunction hideImageError(imageName) {\n    const parentNode = document.getElementById(imageName).parentNode.parentNode;\n    parentNode.querySelector('.w-file-upload-error').style.display = 'none';\n}\n\nexport function showImageState(imageName, state) {\n    const siblings = document.getElementById(imageName).parentNode.parentNode.childNodes;\n    for (let i = 0; i < siblings.length; i++) {\n        if (siblings[i].className.includes(state)) {\n            siblings[i].style.display = 'block';\n        } else {\n            // Hide other states of file input field \"empty-state\" and \"error-state\"\n            siblings[i].style.display = 'none';\n        }\n    }\n}\n\nexport function showLoadingIcon(imageName) {\n    if (imageName === 'frontImage'){\n        document.getElementById(`delete${capitalizeFirstLetter(imageName)}Icon`).style.display = 'none';\n        document.getElementById('enhancedAnimationDiv').style.display = 'block';\n        triggerEnhancingAnimation.click();\n        return\n    }\n    document.getElementById(`loading${capitalizeFirstLetter(imageName)}Icon`).style.display = 'inline-block';\n    document.getElementById(`delete${capitalizeFirstLetter(imageName)}Icon`).style.display = 'none';\n}\n"],"names":["$796bae1b0d1cb952$export$84f874cda6ebf2f2","input","fileName","sessionStorage","getItem","setItem","$796bae1b0d1cb952$export$70c624e1c153d1d3","tempId","image","$796bae1b0d1cb952$var$scaleImageToMaxSize","form","FormData","append","response","fetch","method","body","json","size","Promise","resolve","reject","reader","FileReader","onload","img","document","createElement","width","height","MAX_WIDTH","MAX_HEIGHT","canvas","ctx","getContext","imageSmoothingQuality","drawImage","toBlob","src","result","onerror","readAsDataURL","headers","ok","console","error","statusText","data","id","message","uuidv4","$796bae1b0d1cb952$export$ace0eeb8d81a6535","imageUrl","saveState","imageName","url","enhancedImageUrls","$796bae1b0d1cb952$var$createEnhancedImage","$796bae1b0d1cb952$export$103dee3750c6df19","urlSmall","window","innerWidth","getElementById","style","backgroundImage","$796bae1b0d1cb952$export$f4e19468e22ee9d3","firebase","app","functions","httpsCallable","ex","errorHandler","report","$796bae1b0d1cb952$export$d07f57595c356899","display","imageUrlSmall","newItem","JSON","parse","localStorage","stringify","images","string","charAt","toUpperCase","slice","$796bae1b0d1cb952$export$16814c2c31118a6e","$796bae1b0d1cb952$var$hideImageError","parentNode","querySelector","URL","createObjectURL","$796bae1b0d1cb952$export$484d223052d7ce8a","triggerEnhancingAnimation","click","$796bae1b0d1cb952$export$b8d427576f438d88","$796bae1b0d1cb952$var$showImageError","value","innerText","state","siblings","childNodes","i","length","className","includes","$c6d2db474a2e3f49$var$updateItem","itemId","changedImages","log","$","now","Date","itemSize","material","itemMaterial","brand","itemBrand","model","itemModel","originalPrice","Number","itemOriginalPrice","age","itemAge","condition","itemCondition","defectDescription","itemDefectDescription","userComment","itemUserComment","changes","updatedAt","uploadImages","db","collection","doc","get","then","infoRequests","status","Map","elements","forEach","element","files","file","set","all","Array","from","map","photoDirectionsText","infoRequestImagesDiv","indexOf","item","itemData","coverImage","enhancedFrontImage","updateItemDoc","removeItem","itemRef","update","saveChangesButtonText","color","innerHTML","catch","$c6d2db474a2e3f49$var$fillForm","userId","authUser","current","uid","user","sex","defects","noSmoke","noAnimals","category","showImageAndHideSiblings","x","possibleElmts","frontImageUrl","pageTitle","pageSubTitle","setAttribute","options","attributes","selectedIndex","defectInfoDiv","description","infoRequestImagesText","updateItemFormDiv","pageTitleDiv","loadingDiv","$c6d2db474a2e3f49$var$saveChanges","$c6d2db474a2e3f49$var$changedImages","params","imageElementIds","elemUpload","elemPreviewUploading","elemPreview","addEventListener","Object","keys","elementsArray","querySelectorAll","elem","push","onchange","saveChangesButton","whenSet","autocomplete","brands"],"version":3,"file":"editItem.js.map"}