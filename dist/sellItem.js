!function(){var e;function t(){return new Map().set("hole","H\xe5l").set("stain","Fl\xe4ck").set("lostFit","Tappad passform").set("nopprig","Nopprig").set("threadUp","Tr\xe5dsl\xe4pp").set("colorChange","F\xe4rg\xe4ndring").set("otherDefect","Annat")}function n(){return["frontImage","brandTagImage","defectImage","materialTagImage","extraImage"]}async function a(){// Create item from sessionStorage
if(console.log("sellItemMainAuthenticated "+new Date),// Visa alla "viktiga" fält om man är inloggad
toggleMoreInfoFields.click(),sessionStorage.getItem("itemToBeCreatedAfterSignIn")){// ... if we are redirected here from the sign-in page
if(document.referrer.includes("/sign-in")){document.getElementById("loadingDiv").style.display="flex",document.getElementById("creatingItemText").style.display="block",await p();let e=sessionStorage.getItem("shippingMethod");e&&await firebase.app().functions("europe-west1").httpsCallable("updateFirebaseUser")({preferences:{shippingMethod:e}});let t=user.current?.phoneNumber?.length;return location.href=t?"/item-confirmation":"/user-contact"}sessionStorage.removeItem("itemToBeCreatedAfterSignIn")}// Get user's item count to be able to send 'User Activated' event
let t=await getItems(authUser.current.uid);e=t.size}async function i(){let e,t,a,i,r,o;localStorage.removeItem("latestItemCreated"),sessionStorage.removeItem("itemValuation"),e=document.getElementById("frontImage"),t=document.getElementById("brandTagImage"),a=document.getElementById("productImage"),i=document.getElementById("defectImage"),r=document.getElementById("materialTagImage"),o=document.getElementById("extraImage"),// display image when file has been selected
$("#frontImage").off("change"),e.addEventListener("change",b,{capture:!0}),$("#brandTagImage").off("change"),t.addEventListener("change",M,{capture:!0}),$("#productImage").off("change"),a.addEventListener("change",F,{capture:!0}),$("#defectImage").off("change"),i.addEventListener("change",N,{capture:!0}),$("#materialTag").off("change"),r.addEventListener("change",j,{capture:!0}),$("#extraImage").off("change"),o.addEventListener("change",D,{capture:!0}),setupModelSearchEventListeners(),function(){let e=document.getElementById("itemColor");e.onchange=function(){""!==this.value?e.style.color="#333":e.style.color="#929292"};// Change font color of dropdown itemAge when user selects a value
let t=document.getElementById("itemAge");t.onchange=function(){""!==this.value?t.style.color="#333":t.style.color="#929292"}}(),itemBrand.addEventListener("input",x("itemBrandLabel")),itemBrand.addEventListener("input",U),itemModel.addEventListener("input",x("itemModelLabel")),itemSize.addEventListener("input",x("itemSizeLabel")),itemSize.addEventListener("input",U),itemMaterial.addEventListener("input",x("itemMaterialLabel")),itemMaterial.addEventListener("input",U),itemOriginalPrice.addEventListener("input",x("itemOriginalPriceLabel")),itemAge.addEventListener("input",x("itemAgeLabel")),itemCondition.addEventListener("input",x("itemConditionLabel")),itemColor.addEventListener("change",x("itemColorLabel")),itemColor.addEventListener("input",U),itemUserComment.addEventListener("input",x("userCommentLabel")),document.getElementById("addItemButton").addEventListener("click",()=>{document.getElementById("wf-form-Add-Item").reportValidity();let e=document.getElementById("wf-form-Add-Item").querySelectorAll(":invalid"),t=e?.[0];t&&t.getBoundingClientRect().height<=1&&(t.style.cssText="width:100% !important;height:100% !important;"),setTimeout(()=>{if(e.length>0){if(!function(e){"function"==typeof jQuery&&e instanceof jQuery&&(e=e[0]);let t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight/2||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}(t)){let e=t.getBoundingClientRect().top+window.scrollY-40;window.scrollTo({top:e,behavior:"smooth"})}document.getElementById("wf-form-Add-Item").reportValidity()}},300)}),addItemForm.addEventListener("submit",l),userAddressForm.addEventListener("submit",addUserDetails),autocomplete(document.getElementById("itemBrand"),brands);// Hide/Show warning about difficulty to sell certain brands
let d=document.getElementById("itemBrand");if(document.getElementById("hardToSellDiv"),d.oninput=function(){shareSoldDiv.style.display="none",function(e){if(words.some(t=>e.toLowerCase().includes(t.toLowerCase())))return hardToSellText.innerHTML=`Vi s\xe4ljer i regel inte ${e}-plagg p\xe5 grund av f\xf6r l\xe5gt andrahandsv\xe4rde. Undantag kan finnas.`,hardToSellDiv.style.display="block";hardToSellDiv.style.display="none"}(this.value)},// Hide/Show extra fields for defects
itemCondition.onchange=function(){let e=this.value;"Anv\xe4nd, tecken p\xe5 slitage"==e?(defectInfoDiv.style.display="block",itemCondition.style.color="#333"):""==e?(defectInfoDiv.style.display="none",itemCondition.style.color="#929292"):(defectInfoDiv.style.display="none",itemCondition.style.color="#333")},personalId.addEventListener("input",()=>{let e=isValidSwedishSsn(personalId.value)?"":"Ogiltigt personnummer";personalId.setCustomValidity(e)}),await G(),await R(),await J(),await K(),await H(),function(){let e=new MutationObserver((e,t)=>{let n=e.find(e=>"style"===e.attributeName);n&&"none"===n.target.style.display&&I()});Array.from(document.querySelectorAll(".suggest-buttons")).forEach(t=>e.observe(t,{attributes:!0}))}(),function(){function e(e){let t=e.target;if(t instanceof Element){let e=m()[t.name];e!==t.value&&""!==t.value&&(document.getElementById("clearItemForm").style.display="block")}}document.getElementById("wf-form-Add-Item").addEventListener("input",e),document.querySelector("#wf-form-Add-Item select").addEventListener("change",e)}(),n().forEach(e=>{document.getElementById(`delete${V(e)}Icon`).addEventListener("click",()=>{_(e)})}),document.getElementById("deleteFrontImageIcon").addEventListener("click",()=>{document.getElementById("frontImage").required=!0,_("enhancedFrontImage")}),document.getElementById("deleteBrandTagImageIcon").addEventListener("click",()=>{document.getElementById("brandTagImage").required=!0}),document.getElementById("clearItemForm").addEventListener("click",W),params.id)// Fill form if the user comes from a prefill link (re-sell item)
sessionStorage.removeItem("newItemId"),localStorage.removeItem("newItem"),auth.onAuthStateChanged(function(e){e||(document.getElementById("maiIntro").style.display="block")}),document.getElementById("resellIntro").style.display="block",await B(params.id),document.getElementById("triggerShowSellItemContent").click();else if(sessionStorage.getItem("itemToBeCreatedAfterSignIn")&&document.referrer.includes("/sign-in"));else if(localStorage.getItem("newItem")&&!h(JSON.parse(localStorage.getItem("newItem")))){// Saved state from a previous visit to /sell-item - restore the data
let e=JSON.parse(localStorage.getItem("newItem"));document.getElementById("frontImage").required=!0,document.getElementById("brandTagImage").required=!0,await B(null,e,!0),document.getElementById("clearItemForm").style.display="block",document.getElementById("triggerShowSellItemContent").click()}else document.getElementById("triggerShowSellItemContent").click(),document.getElementById("frontImage").required=!0,document.getElementById("brandTagImage").required=!0;// We delay the rememberUnsavedChanges call to allow any confirm/reject animations to finish
document.getElementById("wf-form-Add-Item").querySelectorAll("input").forEach(e=>{e.addEventListener("input",I)}),document.getElementById("wf-form-Add-Item").querySelectorAll('input[type="radio"]').forEach(e=>{e.addEventListener("change",I)}),document.getElementById("wf-form-Add-Item").querySelectorAll('input[type="checkbox"]').forEach(e=>{e.addEventListener("change",I)}),// We delay the rememberUnsavedChanges call to allow any confirm/reject animations to finish
document.getElementById("wf-form-Add-Item").querySelectorAll("select").forEach(e=>{e.addEventListener("change",I)}),document.getElementById("wf-form-Add-Item").querySelectorAll("textarea").forEach(e=>{e.addEventListener("input",I)}),window.addEventListener("pageshow",e=>{e.persisted&&localStorage.getItem("newItem")&&setTimeout(async()=>{await B(null,JSON.parse(localStorage.getItem("newItem")),!0)},10)})}async function r(){try{let e=await fetch("https://generateuniqueid-heypmjzjfq-ew.a.run.app",{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok)return console.error(`Error: ${e.statusText}`),null;let t=await e.json();return t.id}catch(e){return console.error(`Failed to fetch unique ID, generating uuidv4 id: ${e.message}`,e),uuidv4()}}async function l(t){let n=sessionStorage.getItem("newItemId")||await r();try{document.getElementById("addItemFormDiv").style.display="none",document.getElementById("loadingDiv").style.display="flex",document.getElementById("clearItemForm").style.display="none";let t=await y(n),a=await s(n,t.preferences.userValuationApproval);0===e&&analytics.track("User Activated"),location.href=a}catch(e){errorHandler.report(e),console.error("addItem failed",e)}}function o({humanCheckNeeded:e,newMinMaxLog:t}){return e||t.match(/accept price is above max/i)}async function d(e,t,n){let{minPrice:a,maxPrice:i,decline:r,humanCheckNeeded:l,humanCheckExplanation:d,willNotSell:s,soldPrice:c,version:m,newMinPriceEstimate:u,newMaxPriceEstimate:g,newMinMaxLog:y,adjustmentAllowed:p,newBrand:f,newBrandCategory:I}=t||{};if(!a&&!r)return;let h={mlValuation:{decline:r,humanCheckNeeded:l,minPriceEstimate:a,maxPriceEstimate:i,humanCheckExplanation:d,willNotSellPrediction:s,soldPriceEstimate:c,modelVersion:m?.toString(),newMinPriceEstimate:u,newMaxPriceEstimate:g,newMinMaxLog:y,adjustmentAllowed:p,newBrand:f,newBrandCategory:I},...r||o(t)?{}:{valuationStatus:"Completed",valuationDate:new Date().toISOString(),...n?{}:{minPriceEstimate:a,maxPriceEstimate:i},infoRequests:{price:{status:n?"Active":"Resolved",response:n?"":"Accepted",description:"Vi b\xf6rjar med startpriset, och justerar successivt ner till l\xe4gsta priset under s\xe4ljperioden p\xe5 30 dagar. V\xe4rderingen utg\xe5r fr\xe5n vad liknande s\xe5lts f\xf6r.",minPrice:u||a,maxPrice:g||i}}}};if(sessionStorage.getItem("itemToBeCreatedAfterSignIn")){let e=JSON.parse(sessionStorage.getItem("itemToBeCreatedAfterSignIn"));sessionStorage.setItem("itemToBeCreatedAfterSignIn",JSON.stringify({id:e.id,item:{...e.item,...h}}))}else{await firebase.app().functions("europe-west1").httpsCallable("saveItemValuationFields")({itemId:e,...h});let t=JSON.parse(localStorage.getItem("latestItemCreated"));localStorage.setItem("latestItemCreated",JSON.stringify({...t,...h}))}}async function s(e,t){let n=JSON.parse(sessionStorage.getItem("itemToBeCreatedAfterSignIn")||"{}").item;if(!e&&!n)return console.error("No item and no itemId, unexpected!!"),"/item-confirmation";try{let a=await firebase.app().functions("europe-west1").httpsCallable("itemMlValuation")({itemId:e,item:n}),{minPrice:i,maxPrice:r,decline:l}=a.data||{};return await d(e,a.data,t),c(i&&r,l,o(a.data),t)}catch(e){console.error("Failed to get ml valuation",e)}return c()}function c(e,t,n,a){if(!e||n||!a){if(sessionStorage.getItem("itemToBeCreatedAfterSignIn"))return"/sign-in";let e=user.current?.phoneNumber?.length;return e?"/item-confirmation":"/user-contact"}return"/item-valuation"}function m(){return{acceptPrice:null,age:null,brand:null,category:null,color:null,condition:null,defectDescription:null,defects:[],images:{},material:null,model:null,originalPrice:null,userValuationApproval:!0,sex:"Woman",size:null,userComment:null}}function u(){let e="",n=new Date,a=itemSize.value,i=itemMaterial.value?itemMaterial.value.trim():"",r=itemBrand.value?itemBrand.value.trim():"",l=itemModel.value?itemModel.value.trim():"",o=Number(itemOriginalPrice.value),d=itemAge.value,s=itemCondition.value,c=itemDefectDescription.value?itemDefectDescription.value.trim():"",m=itemUserComment.value?itemUserComment.value.trim():"",u=Number(itemLowestAcceptPrice.value),g=itemUserValuationApproval.checked,y=new Map().set("hole",hole.checked).set("stain",stain.checked).set("lostFit",lostFit.checked).set("nopprig",nopprig.checked).set("threadUp",threadUp.checked).set("colorChange",colorChange.checked).set("otherDefect",otherDefect.checked),p=[];"Anv\xe4nd, tecken p\xe5 slitage"===s&&y.forEach((e,n)=>{if(e){let e=t().get(n);p.push(e)}});for(var f=document.getElementsByName("Sex"),I=0;I<f.length;I++)f[I].checked&&(e=f[I].id);let h=document.getElementById("findModelBoxFilled"),x={};if("flex"===h.style.display){// There is a current model selected grab the cover image and id from it
let e=JSON.parse(h.getAttribute("data-model"));x={modelCoverImageUrl:e.coverImage,atModelVariantId:e.atVariantId}}let S=JSON.parse(localStorage.getItem("newItem")||"{}").images;return{user:authUser.current?.uid||null,createdAt:n.toISOString(),status:"New",shippingStatus:"Not sent",sex:e,size:a,material:i,color:itemColor.value,category:itemCategory.value,brand:r,model:l,originalPrice:o,age:d,condition:s,defects:p,defectDescription:c,userComment:m,acceptPrice:u,preferences:{userValuationApproval:g},...x,images:S}}async function g(){// If first time: User chooses shipping method preference in sell item form
let e="Service point";return user.current?.preferences?.shippingMethod?e=user.current?.preferences?.shippingMethod:authUser.current?await firebase.app().functions("europe-west1").httpsCallable("updateFirebaseUser")({preferences:{shippingMethod:e}}):sessionStorage.setItem("shippingMethod",e),e}async function y(e){let{modelCoverImageUrl:t,images:n,...a}=u(),i=await g();t&&(n.coverImage=t,a.coverImageUpdatedAt=new Date().toISOString());let r=params.id?{createdFromItem:params.id}:{},l={...a,shippingMethod:i,images:n,...r,version:"2"};if(authUser.current){let t=await firebase.app().functions("europe-west1").httpsCallable("createItem")({id:e,item:l});localStorage.removeItem("newItem"),sessionStorage.removeItem("newItemId"),localStorage.setItem("latestItemCreated",JSON.stringify(t.data))}else sessionStorage.setItem("itemToBeCreatedAfterSignIn",JSON.stringify({id:e,item:l}));return l}async function p(){let e=JSON.parse(sessionStorage.getItem("itemToBeCreatedAfterSignIn"));sessionStorage.removeItem("itemToBeCreatedAfterSignIn"),sessionStorage.removeItem("newItemId"),await firebase.app().functions("europe-west1").httpsCallable("createItem")(e),localStorage.removeItem("newItem"),e.item.id=e.id,localStorage.setItem("latestItemCreated",JSON.stringify(e.item))}async function f(e){let t=await createEnhancedImage(e);return t?.url&&(A("enhancedFrontImage",t.url,t.urlSmall),S("frontImage",window.innerWidth<=400?t.urlSmall:t.url)),T("frontImage"),t}function I(){if(localStorage.getItem("latestItemCreated"))return;let{user:e,createdAt:t,status:n,shippingStatus:a,modelVariantFields:i,...r}=u(),l=Object.keys(r).reduce((e,t)=>(e[t]=""===r[t]?null:r[t],e),{});l.defects=l.defects?l.defects:[],l.userValuationApproval=l.preferences.userValuationApproval,delete l.preferences,l.acceptPrice=l.acceptPrice&&l.acceptPrice>0?l.acceptPrice:null,l.originalPrice=l.originalPrice&&l.originalPrice>0?l.originalPrice:null,["itemBrand","itemSize","itemMaterial","itemColor"].forEach(e=>{let t=document.getElementById(e).parentNode.querySelector(".suggest-buttons")||document.getElementById(e).parentNode.parentNode.querySelector(".suggest-buttons");t?.style?.display==="block"&&(l[`${e}Confirm`]=!0)}),h(l)?localStorage.removeItem("newItem"):localStorage.setItem("newItem",JSON.stringify(l))}function h(e){let t=m();for(let n in t)if(n in e){if(t[n]instanceof Object){if(JSON.stringify(t[n])!==JSON.stringify(e[n]))return!1;continue}if(e[n]!==t[n])return!1}return!0}function x(e){return t=>{document.getElementById(e).style.display=t.target.value.length>0?"inline-block":"none"}}function S(e,t){document.getElementById(`${e}Preview`).style.backgroundImage=`url('${t}')`,T(e)}function v(e,t){let n=document.getElementById(e).parentNode.parentNode.childNodes;for(let e=0;e<n.length;e++)n[e].className.includes(t)?n[e].style.display="block":n[e].style.display="none"}function E(e,t,n){if(t&&n){let t=document.getElementById(e).parentNode.querySelector(".suggest-buttons")||document.getElementById(e).parentNode.parentNode.querySelector(".suggest-buttons");t.style.display="block",document.getElementById(e).setCustomValidity("Bekr\xe4fta eller \xe4ndra v\xe4rdet")}}async function B(e,a=null,i=!1){try{let r={data:a};a||(r=await firebase.app().functions("europe-west1").httpsCallable("getItem")({itemId:e}));let l=r.data,o=l.images||{},d=l.originalPrice;// Populate images
for(let e in d<=0&&(d=null),o){let t=o[`${e}Small`]||o[`${e}Medium`]||o[e]||o[`${e}Large`],a=o[e]||o[`${e}Large`]||o[`${e}Medium`]||o[`${e}Small`];n().includes(e)&&(A(e,a,t),"frontImage"===e&&o.enhancedFrontImage&&(t=o.enhancedFrontImageSmall||o.enhancedFrontImageMedium||o.enhancedFrontImage||o.enhancedFrontImageLarge,a=o.enhancedFrontImage||o.enhancedFrontImageLarge||o.enhancedFrontImageMedium||o.enhancedFrontImageSmall,A("enhancedFrontImage",a,t)),S(e,t),v(e,"success-state"),document.getElementById(e).required=!1)}// Show cover image preview if it is a model image, if it is a noBg image we skip it
sessionStorage.removeItem("coverImagePreviewUrl");let s=o.coverImageLarge||o.coverImage||null,c=o.coverImage||o.coverImageLarge||null;s&&!await Y(c)&&(document.getElementById("coverImageContainer").style.backgroundImage=`url('${c}')`,document.getElementById("coverImagePreview").style.display="block",A("modelImage",s,c)),// Populate text input fields
itemBrand.value=l.brand||"",E("itemBrand",i,l.itemBrandConfirm),// Don't use the setFieldValue for the brand since that triggers a dropdown to open
document.getElementById("itemBrandLabel").style.display=l.brand?"inline-block":"none",setFieldValue("itemSize",l.size),E("itemSize",i,l.itemSizeConfirm),setFieldValue("itemMaterial",l.material),E("itemMaterial",i,l.itemMaterialConfirm),setFieldValue("itemModel",l.model),setFieldValue("itemOriginalPrice",d),i&&(setFieldValue("itemUserComment",l.userComment),setFieldValue("itemDefectDescription",l.defectDescription),setFieldValue("itemLowestAcceptPrice",l.acceptPrice<=0?null:l.acceptPrice)),// Populate select fields
k(itemAge,l.age),k(itemColor,l.color),E("itemColor",i,l.itemColorConfirm),k(itemCondition,l.condition),itemCondition.selectedIndex>=0&&"Anv\xe4nd, tecken p\xe5 slitage"===itemCondition.options[itemCondition.selectedIndex].text&&(defectInfoDiv.style.display="block");let m=$("#itemCategory");m.val(l.category),m.trigger("change"),l.sex?(document.getElementById("Woman").previousElementSibling.classList.remove("w--redirected-checked"),document.getElementById("Woman").checked=!1,document.getElementById(l.sex).previousElementSibling.classList.add("w--redirected-checked"),document.getElementById(l.sex).checked=!0):(document.getElementById("Woman").previousElementSibling.classList.add("w--redirected-checked"),document.getElementById("Woman").checked=!0),// Populate checkboxes
t().forEach((e,t)=>{l.defects&&l.defects.includes(e)&&(document.getElementById(t).previousElementSibling.classList.add("w--redirected-checked"),document.getElementById(t).checked=!0)}),i&&"userValuationApproval"in l&&!l.userValuationApproval&&(document.getElementById("itemUserValuationApproval").click(),document.getElementById("itemUserValuationApproval").previousElementSibling.classList.remove("w--redirected-checked"))}catch(e){console.error("Error getting item document:",e),errorHandler.report(e)}document.getElementById("loadingDiv").style.display="none"}function k(e,t){let n=Array.from(e.options).map(e=>e.attributes.value.value).indexOf(t);n>0?(e.selectedIndex=n,e.style.color="#333"):(e.selectedIndex=0,e.style.color="#929292"),e.dispatchEvent(new Event("input")),e.dispatchEvent(new Event("change"))}let w={black:"Black",white:"White",gray:"Grey",blue:"Blue",dark_blue:"Navy","multicolor/colorful":"Multicolour",red:"Red",pink:"Pink",brown:"Brown",beige:"Beige",light_blue:"Blue",green:"Green",silver:"Silver",purple:"Purple",maroon:"Burgundy",gold:"Gold",orange:"Orange",yellow:"Yellow",teal:"Turquoise",olive:"Green",cyan:"Turquoise",magenta:"Pink",mustard:"Yellow"};async function b(e){let t=this.files[0];if(t){e.stopPropagation();let n=await C(t,"frontImage");if(!n||0===Object.keys(n).length)return;let a=[];a.push(z(n),O(n),f(n)),await Promise.all(a),I()}}async function C(e,t){try{!function(e){let t=document.getElementById(e).parentNode.parentNode;t.querySelector(".w-file-upload-error").style.display="none"}(t);let n=URL.createObjectURL(e);document.getElementById(`${t}PreviewUploading`).style.backgroundImage=`url('${n}')`,document.getElementById(`${t}Preview`).style.backgroundImage=`url('${n}')`,function(e){if("frontImage"==e){document.getElementById(`delete${V(e)}Icon`).style.display="none",document.getElementById("enhancedAnimationDiv").style.display="block",triggerEnhancingAnimation.click();return}document.getElementById(`loading${V(e)}Icon`).style.display="inline-block",document.getElementById(`delete${V(e)}Icon`).style.display="none"}(t),v(t,"success-state");let{url:a,urlSmall:i}=await q(e,t);return A(t,a,i),a}catch(n){console.error("Failed to upload image",n),errorHandler.report(n),document.getElementById(`${t}PreviewUploading`).style.backgroundImage="",document.getElementById(`${t}Preview`).style.backgroundImage="",document.getElementById(`loading${V(t)}Icon`).style.display="none",v(t,"default-state"),e.size>10485760?L(t,"Error: Bilden \xe4r f\xf6r stor. Max 10 MB."):L(t,"Error: N\xe5got gick fel vid uppladdning, f\xf6rs\xf6k igen eller kontakt oss om felet kvarst\xe5r."),document.getElementById(t).value=""}}function L(e,t){let n=document.getElementById(e).parentNode.parentNode;n.querySelector(".w-file-upload-error").style.display="block",n.querySelector(".w-file-upload-error-msg").innerText=t}function A(e,t,n){let a=JSON.parse(localStorage.getItem("newItem")||JSON.stringify({})),i=a.images||{};i[e]=t,i[`${e}Small`]=n,a.images=i,localStorage.setItem("newItem",JSON.stringify(a))}async function q(e,t){sessionStorage.getItem("newItemId")||sessionStorage.setItem("newItemId",await r());let n=sessionStorage.getItem("newItemId"),a=await P(e);if(!a)throw"Fel vid bearbetning av vald bild.";let i=new FormData;i.append("itemId",n),i.append("fileName",t),i.append("file",a),i.append("temporary","true"),i.append("generateSmallImage","true");let l=await fetch("https://uploaditemimagebinary-heypmjzjfq-ew.a.run.app",{method:"POST",body:i}),o=await l.json();return o}async function P(e){return e.size<9437184?Promise.resolve(e):new Promise((t,n)=>{let a=new FileReader;a.onload=()=>{let e=document.createElement("img");e.onload=()=>{let n=e.width,a=e.height;n>a?n>1512&&(a*=1512/n,n=1512):a>2016&&(n*=2016/a,a=2016);let i=document.createElement("canvas");i.width=n,i.height=a;let r=i.getContext("2d");r.imageSmoothingQuality="high",r.drawImage(e,0,0,n,a),i.toBlob(t,"image/jpeg")},e.src=a.result,a.onerror=n},a.readAsDataURL(e)})}async function M(e){let t=this.files[0];if(t){e.stopPropagation();let n=await C(t,"brandTagImage");T("brandTagImage"),await O(n),I()}}function V(e){return e.charAt(0).toUpperCase()+e.slice(1)}function T(e){document.getElementById(`loading${V(e)}Icon`).style.display="none",document.getElementById(`delete${V(e)}Icon`).style.display="inline-block","frontImage"===e&&(document.getElementById("enhancedAnimationDiv").style.display="none")}async function F(e){let t=this.files[0];if(t){e.stopPropagation();let n=await C(t,"productImage");T("productImage"),await O(n),I()}}async function N(e){let t=this.files[0];if(t){e.stopPropagation();let n=await C(t,"defectImage");T("defectImage"),await O(n),I()}}async function j(e){let t=this.files[0];if(t){e.stopPropagation();let n=await C(t,"materialTagImage");T("materialTagImage"),await O(n),I()}}async function D(e){let t=this.files[0];if(t){e.stopPropagation();let n=await C(t,"extraImage");T("extraImage"),await O(n),I()}}function U(e){e.currentTarget.setCustomValidity("");let t=e.currentTarget.parentNode.querySelector(".suggest-buttons")||e.currentTarget.parentNode.parentNode.querySelector(".suggest-buttons");t.style.display="none"}async function O(e){try{if(document.querySelector("#itemBrand").value.length&&document.querySelector("#itemMaterial").value.length&&document.querySelector("#itemSize").value.length)return;let t=await firebase.app().functions("europe-west1").httpsCallable("detectItemBrandAndMaterialAndSize")({imageUrl:e});!document.querySelector("#itemBrand").value.length&&t.data?.brand&&(document.querySelector("#itemBrand").value=t.data.brand,document.querySelector("#itemBrand").setCustomValidity("Bekr\xe4fta eller \xe4ndra m\xe4rket"),document.getElementById("itemBrandLabel").style.display="inline-block",document.querySelector("#brandSuggestButtons").style.display="block",document.querySelector("#itemBrand").dispatchEvent(new Event("change")),analytics.track("Element Viewed",{elementID:"brandSuggestButtons"})),!document.querySelector("#itemMaterial").value.length&&t.data?.materials&&(document.querySelector("#itemMaterial").value=t.data.materials,document.querySelector("#itemMaterial").setCustomValidity("Bekr\xe4fta eller \xe4ndra materialet"),document.getElementById("itemMaterialLabel").style.display="inline-block",document.querySelector("#materialSuggestButtons").style.display="block",document.querySelector("#itemMaterial").dispatchEvent(new Event("change")),analytics.track("Element Viewed",{elementID:"materialSuggestButtons"})),!document.querySelector("#itemSize").value.length&&t.data?.size&&(document.querySelector("#itemSize").value=t.data.size,document.querySelector("#itemSize").setCustomValidity("Bekr\xe4fta eller \xe4ndra storlek"),document.getElementById("itemSizeLabel").style.display="inline-block",document.querySelector("#sizeSuggestButtons").style.display="block",document.querySelector("#itemSize").dispatchEvent(new Event("change")),analytics.track("Element Viewed",{elementID:"sizeSuggestButtons"}))}catch(e){errorHandler.report(e),console.log("Error calling detectItemBrandAndMaterialAndSize",e)}}async function z(e){try{let t=await firebase.app().functions("europe-west1").httpsCallable("detectItemColor")({imageUrl:e});if(!t.data?.colors||!t.data.colors.length){console.log("Unable to detect product color");return}if(t.data.colors.length>2)document.querySelector("#itemColor").value="Multicolour";else if(w[t.data.colors?.[0]])document.querySelector("#itemColor").value=w[t.data.colors?.[0]];else{console.log("Unable to set color from",t.data.colors?.[0]);return}document.querySelector("#itemColor").setCustomValidity("Bekr\xe4fta eller \xe4ndra f\xe4rgen"),document.querySelector("#colorSuggestButtons").style.display="block",document.querySelector("#itemColor").dispatchEvent(new Event("change")),analytics.track("Element Viewed",{elementID:"colorSuggestButtons"})}catch(e){errorHandler.report(e),console.log("Error calling detectItemColor",e)}}async function K(){document.getElementById("rejectMaterial").addEventListener("click",()=>{document.querySelector("#itemMaterial").value="",document.querySelector("#materialSuggestButtons").style.display="none",x("itemMaterialLabel"),document.querySelector("#itemMaterial").setCustomValidity("")}),document.getElementById("confirmMaterial").addEventListener("click",()=>{document.querySelector("#itemMaterial").setCustomValidity("")})}async function J(){document.getElementById("rejectBrand").addEventListener("click",()=>{document.querySelector("#itemBrand").value="",document.querySelector("#brandSuggestButtons").style.display="none",document.querySelector("#itemBrand").setCustomValidity(""),x("itemBrandLabel")}),document.getElementById("confirmBrand").addEventListener("click",()=>{document.querySelector("#itemBrand").setCustomValidity(""),document.querySelector("#itemBrand").setCustomValidity("")})}async function H(){document.getElementById("rejectSize").addEventListener("click",()=>{document.querySelector("#itemSize").value="",document.querySelector("#sizeSuggestButtons").style.display="none",x("itemBrandLabel"),document.querySelector("#itemSize").setCustomValidity("")}),document.getElementById("confirmSize").addEventListener("click",()=>{document.querySelector("#itemSize").setCustomValidity("")})}async function R(){document.getElementById("rejectColor").addEventListener("click",()=>{document.querySelector("#itemColor").value="",document.querySelector("#colorSuggestButtons").style.display="none",x("itemColorLabel"),document.querySelector("#itemColor").setCustomValidity("")}),document.getElementById("confirmColor").addEventListener("click",()=>{document.querySelector("#itemColor").setCustomValidity("")})}function W(){document.getElementById("clearItemForm").style.display="none",n().forEach(e=>{document.getElementById(`${e}Preview`).style.backgroundImage="",v(e,"default-state")}),setFieldValue("itemBrand",null),Array.from(document.querySelectorAll(".suggest-buttons")).forEach(e=>e.style.display="none"),setFieldValue("itemSize",null),setFieldValue("itemMaterial",null),setFieldValue("itemModel",null),setFieldValue("itemOriginalPrice",null),setFieldValue("itemUserComment",null),setFieldValue("itemDefectDescription",null),setFieldValue("itemLowestAcceptPrice",null),k(itemAge,""),k(itemColor,""),k(itemCondition,""),defectInfoDiv.style.display="none";let e=$("#itemCategory");e.val(""),e.trigger("change"),// Populate radio-buttons
document.getElementById("Man").previousElementSibling.classList.remove("w--redirected-checked"),document.getElementById("Man").checked=!1,document.getElementById("Unisex").previousElementSibling.classList.remove("w--redirected-checked"),document.getElementById("Unisex").checked=!1,document.getElementById("Woman").previousElementSibling.classList.add("w--redirected-checked"),document.getElementById("Woman").checked=!0,// Populate checkboxes
t().forEach((e,t)=>{document.getElementById(t).previousElementSibling.classList.remove("w--redirected-checked"),document.getElementById(t).checked=!1}),!1===document.getElementById("itemUserValuationApproval").checked&&(document.getElementById("itemUserValuationApproval").click(),document.getElementById("itemUserValuationApproval").previousElementSibling.classList.add("w--redirected-checked")),sessionStorage.removeItem("newItemId"),localStorage.removeItem("newItem")}function _(e){let t=JSON.parse(localStorage.getItem("newItem"));delete t?.images?.[e],delete t?.images?.[`${e}Small`],localStorage.setItem("newItem",JSON.stringify(t))}async function G(){$("#itemCategory").select2({selectionCssClass:"form-field",placeholder:"Kategori",data:[{id:"",text:""},{text:"\xd6verdelar",children:[{id:"Tr\xf6ja",text:"Tr\xf6ja"},{id:"Blus",text:"Blus"},{id:"Topp",text:"Topp"},{id:"Skjorta",text:"Skjorta"},{id:"Linneskjorta",text:"Linneskjorta"},{id:"T-shirt",text:"T-shirt"},{id:"Kavaj",text:"Kavaj"},{id:"Sweatshirt",text:"Sweatshirt"},{id:"Hoodie",text:"Hoodie"},{id:"Polotr\xf6ja",text:"Polotr\xf6ja"},{id:"Tunika",text:"Tunika"},{id:"V\xe4st",text:"V\xe4st"},{id:"Kofta",text:"Kofta"},{id:"Linne",text:"Linne"},{id:"Tr\xe4ningstr\xf6ja",text:"Tr\xe4ningstr\xf6ja"},{id:"Poncho",text:"Poncho"},{id:"Pik\xe9",text:"Pik\xe9"},{id:"L\xe5ng\xe4rmad T-shirt",text:"L\xe5ng\xe4rmad T-shirt"},{id:"Kostymv\xe4st",text:"Kostymv\xe4st"}]},{text:"Underdelar",children:[{id:"Kjol",text:"Kjol"},{id:"Byxor",text:"Byxor"},{id:"Jeans",text:"Jeans"},{id:"Chinos",text:"Chinos"},{id:"Fritidsbyxor",text:"Fritidsbyxor"},{id:"Tr\xe4ningsbyxor",text:"Tr\xe4ningsbyxor"},{id:"Tights",text:"Tights"},{id:"Strumpbyxor",text:"Strumpbyxor"},{id:"Mjukisbyxor",text:"Mjukisbyxor"},{id:"Kostymbyxor",text:"Kostymbyxor"},{id:"Shorts",text:"Shorts"},{id:"Sarong",text:"Sarong"}]},{text:"Helkropp",children:[{id:"Kl\xe4nning",text:"Kl\xe4nning"},{id:"Kaftan",text:"Kaftan"},{id:"Kostym",text:"Kostym"},{id:"Set",text:"Set"},{id:"Jumpsuit",text:"Jumpsuit"},{id:"Baddr\xe4kt",text:"Baddr\xe4kt"},{id:"Bikini",text:"Bikini"},{id:"Pyjamas",text:"Pyjamas"},{id:"Morgonrock",text:"Morgonrock"},{id:"Br\xf6llopskl\xe4nning",text:"Br\xf6llopskl\xe4nning"},{id:"Balkl\xe4nning",text:"Balkl\xe4nning"},{id:"Bodysuit",text:"Bodysuit"},{id:"Underst\xe4ll",text:"Underst\xe4ll"}]},{text:"Ytterkl\xe4der",children:[{id:"Jacka",text:"Jacka"},{id:"Kappa",text:"Kappa"},{id:"Rock",text:"Rock"},{id:"Fritidsjacka",text:"Fritidsjacka"},{id:"Trenchcoat",text:"Trenchcoat"},{id:"Skinnjacka",text:"Skinnjacka"},{id:"Dunjacka",text:"Dunjacka"},{id:"Regnjacka",text:"Regnjacka"},{id:"P\xe4lsjacka",text:"P\xe4lsjacka"}]},{text:"Skor",children:[{id:"Sneakers",text:"Sneakers"},{id:"Sandaler",text:"Sandaler"},{id:"Klackar",text:"Klackar"},{id:"Ballerinaskor",text:"Ballerinaskor"},{id:"Loafers",text:"Loafers"},{id:"Flip-flops",text:"Flip-flops"},{id:"Boots",text:"Boots"},{id:"K\xe4ngor",text:"K\xe4ngor"},{id:"Vinterskor",text:"Vinterskor"},{id:"Skor",text:"Annat (Skor)"}]},{text:"V\xe4skor",children:[{id:"Axelremsv\xe4ska",text:"Axelremsv\xe4ska"},{id:"Handv\xe4ska",text:"Handv\xe4ska"},{id:"Kuvertv\xe4ska",text:"Kuvertv\xe4ska"},{id:"Ryggs\xe4ck",text:"Ryggs\xe4ck"},{id:"Tr\xe4ningsv\xe4ska",text:"Tr\xe4ningsv\xe4ska"},{id:"Resv\xe4ska",text:"Resv\xe4ska"},{id:"Datorv\xe4ska",text:"Datorv\xe4ska"},{id:"V\xe4ska",text:"Annat (V\xe4ska)"}]},{text:"Accessoarer",children:[{id:"Solglas\xf6gon",text:"Solglas\xf6gon"},{id:"Glas\xf6gon",text:"Glas\xf6gon"},{id:"\xd6rh\xe4nge",text:"\xd6rh\xe4nge"},{id:"Halsband",text:"Halsband"},{id:"Armband",text:"Armband"},{id:"Ring",text:"Ring"},{id:"Brosch",text:"Brosch"},{id:"Keps",text:"Keps"},{id:"Sjal",text:"Sjal"},{id:"Krage",text:"Krage"},{id:"B\xe4lte",text:"B\xe4lte"},{id:"Pl\xe5nbok",text:"Pl\xe5nbok"},{id:"Halsduk",text:"Halsduk"},{id:"Hatt",text:"Hatt"},{id:"M\xf6ssa",text:"M\xf6ssa"},{id:"Vantar",text:"Vantar"},{id:"Necess\xe4r",text:"Necess\xe4r"},{id:"Slips",text:"Slips"},{id:"Handduk",text:"Handduk"},{id:"Klocka",text:"Klocka"}]}]}),$("body").on("click",".select2-container--open .select2-results__group",function(){$(this).parent().attr("class").match(/expanded-group/)?$(this).parent().removeClass("expanded-group"):($(".expanded-group").first().removeClass("expanded-group"),$(this).parent().addClass("expanded-group"))});let e=!1;$("#itemCategory").on("select2:select",()=>{analytics.track("Click",{elementID:"itemCategoryValue"}),document.querySelector("#itemCategory").dispatchEvent(new Event("change"))});let t=!1;$("#itemCategory").on("select2:open",()=>{t||(t=!0,$("input.select2-search__field").on("click",()=>{analytics.track("Click",{elementID:"itemCategorySearch"})}))}),$("#itemCategory").on("select2:close",()=>{document.querySelector("body").style.overflow="auto",document.querySelector("body").style.position="static",document.querySelector("html").style.overflow="static"}),$("#itemCategory").on("select2:open",function(){analytics.track("Element Viewed",{elementID:"itemCategoryContainer"}),document.querySelector("body").style.overflow="hidden",document.querySelector("body").style.position="fixed",document.querySelector("html").style.overflow="fixed";let t=document.querySelector(".select2-search__field");if(t.placeholder="S\xf6k... (t.ex. Kl\xe4nning/Sneakers/Blus)",$(".select2-search__field").on("input",e=>{e.target.value.length>0?$(".select2-results__option[role=group]").each((e,t)=>$(t).addClass("expanded-group")):$(".expanded-group").each((e,t)=>$(t).removeClass("expanded-group"))}),!e){let t=document.getElementById("categoryPopUpHeader"),n=document.querySelector(".select2-dropdown");n.insertBefore(t,n.firstChild),t.style.display="block",t.querySelector("#categorySelectClose").onclick=()=>$("#itemCategory").select2("close"),e=!0}document.querySelector(".select2-results__options").addEventListener("scroll",()=>document.activeElement.blur())}),$("#itemCategory").on("change",x("itemCategoryLabel")),// From https://github.com/select2/select2/issues/3015#issuecomment-570171720
$("#itemCategory").on("select2:open",function(){$(".select2-results").css("visibility","hidden")}),$("#itemCategory").on("select2:opening",function(){setTimeout(function(){$(".select2-results").css("visibility","visible")},50)})}let Y=async e=>{let t=async e=>{let t=new Image;return t.crossOrigin="Anonymous",t.src=e,await t.decode(),t},n=e=>{let[t,n,a,i]=[e[0],e[1],e[2],e[3]];for(let r=4;r<e.length;r+=4)if(e[r]!==t||e[r+1]!==n||e[r+2]!==a||e[r+3]!==i)return!1;return!0};try{if(e.match(/nobg|no-bg/i))return!0;let a=await t(e),i=document.createElement("canvas"),r=i.getContext("2d");r.drawImage(a,0,0,a.naturalWidth,a.naturalHeight);let l=r.getImageData(0,0,a.naturalWidth,10).data,o=r.getImageData(0,a.naturalHeight-10,a.naturalWidth,10).data,d=r.getImageData(0,0,10,a.naturalHeight).data,s=r.getImageData(a.naturalWidth-10,0,10,a.naturalHeight).data;return n(l)&&n(o)&&n(d)&&n(s)}catch(e){// If we cannot load the image, play it safe and assume it is the no-bg image
return console.error(e),!0}};// Call sellItemMain directly
i(),// and call sellItemMainAuthenticated after/when a user has logged in
user.whenSet(a)}();//# sourceMappingURL=sellItem.js.map

//# sourceMappingURL=sellItem.js.map
