{"mappings":"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","sources":["<anon>","signIn.js","cookieManagement.js","general.js","referralFunctions.js"],"sourcesContent":["(function () {\n\nfunction $3940e9575021adc4$export$3504821f567315c9() {\n    // Get params\n    var queryStr = window.location.search;\n    var paramPairs = queryStr.substring(1).split(\"&\");\n    var params = {};\n    for(var i = 0; i < paramPairs.length; i++){\n        var parts = paramPairs[i].split(\"=\");\n        params[parts[0]] = decodeURIComponent(parts[1]);\n    }\n    return params;\n}\nfunction $3940e9575021adc4$var$signOut() {\n    firebase.auth().signOut().then(()=>{\n        console.log(\"User signed out\");\n        authUser.current = null;\n        user.current = null;\n        userId = null;\n        location.href = \"/\";\n        (0, $460064d413045c7d$export$b43e45590305ffaa)(\"maiAuth\");\n    }).catch((error)=>{\n        errorHandler.report(error);\n        console.log(error);\n    });\n}\nfunction $3940e9575021adc4$export$dafa36e3c090bd7e(user1) {\n    document.getElementById(\"addressFirstName\").value = user1.addressFirstName || \"\";\n    document.getElementById(\"addressFirstName\").dispatchEvent(new Event(\"input\"));\n    document.getElementById(\"addressLastName\").value = user1.addressLastName || \"\";\n    document.getElementById(\"addressLastName\").dispatchEvent(new Event(\"input\"));\n    document.getElementById(\"addressStreetAddress\").value = user1.addressStreetAddress || \"\";\n    document.getElementById(\"addressStreetAddress\").dispatchEvent(new Event(\"input\"));\n    document.getElementById(\"addressCO\").value = user1.addressCO || \"\";\n    document.getElementById(\"addressCO\").dispatchEvent(new Event(\"input\"));\n    document.getElementById(\"addressPostalCode\").value = user1.addressPostalCode || \"\";\n    document.getElementById(\"addressPostalCode\").dispatchEvent(new Event(\"input\"));\n    document.getElementById(\"addressCity\").value = user1.addressCity || \"\";\n    document.getElementById(\"addressCity\").dispatchEvent(new Event(\"input\"));\n    document.getElementById(\"addressDoorCode\").value = user1.addressDoorCode || \"\";\n    document.getElementById(\"addressDoorCode\").dispatchEvent(new Event(\"input\"));\n}\nfunction $3940e9575021adc4$export$bb56b8325423933() {\n    let addressFirstName = document.getElementById(\"addressFirstName\").value;\n    let addressLastName = document.getElementById(\"addressLastName\").value;\n    let addressStreetAddress = document.getElementById(\"addressStreetAddress\").value;\n    let addressCO = document.getElementById(\"addressCO\").value;\n    let addressPostalCode = document.getElementById(\"addressPostalCode\").value;\n    let addressCity = document.getElementById(\"addressCity\").value;\n    let addressDoorCode = document.getElementById(\"addressDoorCode\").value;\n    addressFirstName = addressFirstName ? addressFirstName.trim().charAt(0).toUpperCase() + addressFirstName.trim().slice(1) : \"\";\n    addressLastName = addressLastName ? addressLastName.trim().charAt(0).toUpperCase() + addressLastName.trim().slice(1) : \"\";\n    addressStreetAddress = addressStreetAddress ? addressStreetAddress.trim().charAt(0).toUpperCase() + addressStreetAddress.trim().slice(1) : \"\";\n    addressCO = addressCO ? addressCO.trim() : \"\";\n    addressPostalCode = addressPostalCode ? addressPostalCode.trim().replace(/\\D/g, \"\") : \"\";\n    addressCity = addressCity ? addressCity.trim().charAt(0).toUpperCase() + addressCity.trim().slice(1) : \"\";\n    addressDoorCode = addressDoorCode ? addressDoorCode.trim() : \"\";\n    return {\n        addressFirstName: addressFirstName,\n        addressLastName: addressLastName,\n        addressStreetAddress: addressStreetAddress,\n        addressCO: addressCO,\n        addressPostalCode: addressPostalCode,\n        addressCity: addressCity,\n        addressDoorCode: addressDoorCode\n    };\n}\nfunction $3940e9575021adc4$export$6186634e4bafe14d(ssn) {\n    ssn = ssn.replace(/\\D/g, \"\") // strip out all but digits\n    .split(\"\") // convert string to array\n    .reverse() // reverse order for Luhn\n    .slice(0, 10); // keep only 10 digits (i.e. 1977 becomes 77)\n    // verify we got 10 digits, otherwise it is invalid\n    if (ssn.length !== 10) return false;\n    const sum = ssn.map((n)=>Number(n)).reduce((previous, current, index)=>{\n        if (index % 2) current *= 2;\n        if (current > 9) current -= 9;\n        return previous + current;\n    });\n    return 0 === sum % 10;\n}\nfunction $3940e9575021adc4$export$2b32a697e92b0edc(personalIdInput) {\n    let personalId = personalIdInput.replace(\"-\", \"\");\n    if (personalId.length !== 12 && (personalId.substring(0, 2) !== \"19\" || personalId.substring(0, 2) !== \"20\")) {\n        if (Number(personalId.substring(0, 2)) <= 99 && Number(personalId.substring(0, 2)) > 25) personalId = \"19\" + personalId;\n        else personalId = \"20\" + personalId;\n    }\n    if (personalId.length === 12) return personalId;\n    return null;\n}\nfunction $3940e9575021adc4$export$b49e2d49708b2f8e(item) {\n    const images = item.images;\n    if (images.modelImage) return images.modelImageSmall || images.modelImage;\n    if (images.coverImage) return images.coverImageSmall || images.coverImage;\n    if (images.enhancedFrontImage) return images.enhancedFrontImageSmall || images.enhancedFrontImage;\n    return images.frontImageSmall || images.frontImage;\n}\nfunction $3940e9575021adc4$export$82ce321a7c87aa7e() {\n    const code = user.current.referralData.referralCode;\n    const text = `Hej, jag vill tipsa om Mai för att rensa ur garderoben. Mai är en tjänst som hjälper dig att sälja dina kläder på ett enkelt sätt. Man tar bara bilder på sina plagg, sedan sköter Mai resten - såsom värdering, annonsering på flera plattformar, kontakt med köpare och frakt när det blir sålt. Man får själv behålla 80% av vinsten, och blir det inte sålt kostar det ingenting.\\n\\nOm du registrerar dig med min kod (följ länken) och provar sälja ett plagg inom 7 dagar får du behålla 100% av vinsten för det första plagget (istället för 80%). Min kod: ${code}\\n\\nLäs mer och använd min kod här:`;\n    if (navigator.share) navigator.share({\n        text: text,\n        url: `https://maiapp.se/?invite=${code}`\n    }).then(()=>{\n        console.log(\"Thanks for sharing!\");\n    }).catch((e)=>{\n        console.error(e);\n        errorHandler.report(e);\n    });\n    else {\n        console.log(\"Browser doesn't support navigator.share => Copy to clipboard!\");\n        const shareText = text + \"\\n\" + `https://maiapp.se/?invite=${code}`;\n        navigator.clipboard.writeText(shareText);\n        linkCopiedBanner.style.display = \"flex\";\n        setTimeout(function() {\n            linkCopiedBanner.style.display = \"none\";\n        }, 1500);\n    }\n}\n\n\nfunction $460064d413045c7d$export$110700823644f4a6(cname, cvalue, exdays) {\n    const d = new Date();\n    d.setTime(d.getTime() + exdays * 86400000);\n    let expires = \"expires=\" + d.toUTCString();\n    cvalue = cvalue.replaceAll(\"+\", \" \");\n    cvalue = encodeURIComponent(cvalue);\n    document.cookie = cname + \"=\" + cvalue + \";\" + expires + \";path=/\";\n//console.log(\"Cookie set: \", cname + \"=\" + cvalue);\n}\nfunction $460064d413045c7d$export$b43e45590305ffaa(cname) {\n    document.cookie = cname + \"=; Max-Age=-99999999;\";\n}\nfunction $460064d413045c7d$export$4be65e66cfa2648a(cname) {\n    let name = cname + \"=\";\n    let ca = document.cookie.split(\";\");\n    for(let i = 0; i < ca.length; i++){\n        let c = ca[i];\n        while(c.charAt(0) == \" \")c = c.substring(1);\n        if (c.indexOf(name) == 0) {\n            c = c.substring(name.length, c.length);\n            return decodeURIComponent(c);\n        }\n    }\n    return \"\";\n}\nconst $460064d413045c7d$var$preferredLoginMethodCookieName = \"preferredLoginMethod\";\nconst $460064d413045c7d$export$5708bb885f22a021 = ()=>$460064d413045c7d$export$4be65e66cfa2648a($460064d413045c7d$var$preferredLoginMethodCookieName);\nfunction $460064d413045c7d$export$77d0370c0552de62(providerId) {\n    $460064d413045c7d$export$110700823644f4a6($460064d413045c7d$var$preferredLoginMethodCookieName, providerId, 6000);\n}\n\n\n// REFERRAL PROGRAM FUNCTIONS\n\nasync function $76d021fe719fc46a$export$bbf06223657032d7() {\n    if (user.current?.referralData?.referralCode) {\n        document.getElementById(\"myReferralCodeText\").innerHTML = user.current.referralData.referralCode;\n        if (user.current?.referralData?.activatedReferredUsersCount > 0) // shareCodeState 'block', but should also show the bonus received... TODO\"... Eller förresten, detta ska nog ligga på en referral sida + SMS\n        shareCodeState.style.display = \"block\";\n        else shareCodeState.style.display = \"block\";\n    }\n    referralSection.style.display = \"block\";\n}\nasync function $76d021fe719fc46a$export$4fcf92c87dcae3df() {\n    const userCreatedDate = new Date(authUser.current.metadata.creationTime);\n    const now = new Date();\n    let daysDiff = (now.getTime() - userCreatedDate.getTime()) / 86400000;\n    console.log(\"Days since user registered\", daysDiff);\n    const referralData = user.current?.referralData;\n    if (referralData && referralData?.referredBy && !referralData?.referredByBonusPaid && !referralData?.referredByDiscountUsed) {\n        // Get inviters first name\n        const inviter = referralData?.referredBy;\n        const res = await firebase.app().functions(\"europe-west3\").httpsCallable(\"referrerName\")({\n            referrerId: inviter\n        });\n        console.log(\"referrerName result\", res);\n        await $76d021fe719fc46a$var$showActivatedBonus(res?.data?.name, res?.data?.code);\n        bonusSection.style.display = \"block\";\n        return;\n    }\n    if ((user.current?.referralData?.referredBy ? false : true) && daysDiff <= 30) {\n        if (bonusActivatedState.style.display === \"none\") {\n            enterCodeState.style.display = \"block\";\n            bonusSection.style.display = \"block\";\n        }\n    }\n}\nasync function $76d021fe719fc46a$var$showActivatedBonus(referrerName, referrerCode) {\n    console.log(\"showActivatedBonus run\");\n    let bonusNameText = \"BONUS\";\n    if (referrerName && referrerName !== \"Mai\") bonusNameText = \"BONUS - INBJUDEN AV \" + referrerName.toUpperCase();\n    else if (referrerCode) bonusNameText = \"BONUS - \" + referrerCode.toUpperCase();\n    if (document.getElementById(\"bonusSection\")) {\n        document.getElementById(\"bonusName\").innerHTML = bonusNameText;\n        document.getElementById(\"bonusActivatedState\").style.display = \"block\";\n        document.getElementById(\"enterCodeState\").style.display = \"none\";\n        bonusSection.style.display = \"block\";\n    }\n}\nasync function $76d021fe719fc46a$export$3bf9b2a1d1ff9c1a() {\n    if (!user.current?.referralData?.referralCode) {\n        const referralCode = await firebase.app().functions(\"europe-west3\").httpsCallable(\"setUserReferralCode\")();\n        console.log(\"New referral code stored: \", referralCode?.data?.referralCode);\n        user.current.referralData = {\n            ...user.current.referralData,\n            referralCode: referralCode?.data?.referralCode\n        };\n        await $76d021fe719fc46a$export$bbf06223657032d7();\n    }\n}\nasync function $76d021fe719fc46a$var$showReferralErrorMessage(msg) {\n    // Show message they can't add their own code\n    errorBannerMessage.innerHTML = msg ? msg : errorBannerMessage.innerHTML;\n    errorMessageBanner.style.display = \"flex\";\n    saveRefCodeLoadingDiv.style.display = \"none\";\n    saveReferralCodeButton.style.display = \"inline-block\";\n    //saveReferralCodeButton.click(); //To trigger animation\n    setTimeout(function() {\n        errorMessageBanner.style.display = \"none\";\n    }, 2500);\n}\nasync function $76d021fe719fc46a$export$28c7efcd0a6b27b(inputCode) {\n    inputCode = inputCode.trim().toUpperCase();\n    if (inputCode === user.current?.referralData?.referralCode) {\n        await $76d021fe719fc46a$var$showReferralErrorMessage(\"Du kan inte aktivera din egen kod\");\n        return;\n    }\n    // Find user with matching referral code and connect users\n    try {\n        const res = await firebase.app().functions(\"europe-west3\").httpsCallable(\"connectReferralUser\")({\n            code: inputCode\n        });\n        (0, $460064d413045c7d$export$b43e45590305ffaa)(\"invite\");\n        console.log(\"connecReferralUser response: \", res);\n        if (res?.data?.code === 400) return;\n        if (res?.data?.name) {\n            await $76d021fe719fc46a$var$showActivatedBonus(res?.data?.name, inputCode);\n            console.log(\"Referral connection successfully stored\");\n        } else {\n            console.log(\"Failed to use referral code\", res?.data);\n            await $76d021fe719fc46a$var$showReferralErrorMessage(`Koden ${inputCode} finns inte`);\n        }\n    } catch (e) {\n        errorHandler.report(e);\n        console.log(\"Failed to use referral code\", e);\n    }\n}\n\n\nwindow.recaptchaVerifier = new firebase.auth.RecaptchaVerifier(\"sendCodeButton\", {\n    \"size\": \"invisible\",\n    \"callback\": (response)=>{\n        // reCAPTCHA solved, allow signInWithPhoneNumber.\n        onSignInSubmit();\n    }\n});\nconsole.log(\"Check onAuthStateChanged: \", new Date());\nfirebase.auth().onAuthStateChanged(async (result)=>{\n    console.log(\"onAuthStateChanged callback: \", new Date());\n    const now = new Date().toISOString();\n    if (result) {\n        // Get and set current user\n        const authenticated = result;\n        authUser.current = authenticated;\n        console.log(\"authUser:\", authUser.current);\n        localStorage.setItem(\"authUserId\", authenticated.uid);\n        try {\n            (0, $460064d413045c7d$export$77d0370c0552de62)(authenticated.providerData[0].providerId);\n            const doc = await db.collection(\"users\").doc(authenticated.uid).get();\n            if (doc.exists) {\n                identify(authenticated, doc.data());\n                console.log(\"user:\", doc.data());\n                user.current = doc.data();\n            }\n            await $cbfb271301266793$var$saveRefreshToken();\n        } catch (error) {\n            errorHandler.report(error);\n            console.log(\"Error getting document:\", error);\n        }\n    } else {\n        console.log(\"No user\");\n        localStorage.removeItem(\"authUserId\");\n        // Go to landing page if no user and on logged in pages\n        const path = window.location.pathname;\n        // Latest page view for logged out users\n        analytics.identify({\n            latestPageView: now\n        });\n        if (path === \"/private\" || path === \"/personal-id-form\" || path === \"/address-form\" || path === \"/item\" || path === \"/ship-item\" || path === \"/edit-item\" || path === \"/order-bags\") location.href = \"./\";\n        if (path === \"/\") {\n            headerLoginLoading.style.display = \"none\";\n            headerLoginButton.style.display = \"flex\";\n        }\n    }\n});\nasync function $cbfb271301266793$var$saveRefreshToken() {\n    const refreshToken = authUser.current.refreshToken;\n    const idToken = await authUser.current.getIdToken();\n    try {\n        // TODO: Change to maiapp.se to go live\n        return await fetch(\"https://api.shh-test.page/maiappAuth\", {\n            credentials: \"include\",\n            headers: {\n                \"Authorization\": \"Bearer \" + idToken,\n                \"X-Mai-Refresh-Token\": refreshToken\n            }\n        });\n    } catch (ex) {\n        errorHandler.report(ex);\n        console.log(\"Error setting cookie with refresh token\", ex);\n    }\n}\nasync function $cbfb271301266793$var$loginWithCookieToken() {\n    const cookie = (0, $460064d413045c7d$export$4be65e66cfa2648a)(\"maiAuth\");\n    if (!cookie?.length) return;\n    if (authUser.current) return; // No need to log in\n    try {\n        // Get an id token that can be validated by the firebase function maiappAuth\n        const refreshResponse = await fetch(`https://securetoken.googleapis.com/v1/token?key=${firebaseConfig.apiKey}`, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n                grant_type: \"refresh_token\",\n                refresh_token: cookie\n            })\n        });\n        const refreshJson = await refreshResponse.json();\n        if (refreshJson.id_token && !authUser.current) {\n            // Get a custom token that we can use to sign in\n            const customTokenResponse = await fetch(`https://api.shh-test.page/maiappAuth?id_token=${refreshJson.id_token}`);\n            const customTokenJson = await customTokenResponse.json();\n            if (customTokenJson.status === \"customToken\" && !authUser.current) await firebase.auth().signInWithCustomToken(customTokenJson.customToken);\n        }\n    } catch (ex) {\n        errorHandler.report(ex);\n        console.log(\"Failed to log in using saved token\", ex);\n    }\n}\n$cbfb271301266793$var$loginWithCookieToken();\nfunction $cbfb271301266793$var$userIsSellingNewItem() {\n    return sessionStorage.getItem(\"itemToBeCreatedAfterSignIn\") && (document.referrer.includes(\"/sell-item\") || document.referrer.includes(\"/item-valuation\"));\n}\nasync function $cbfb271301266793$var$updateFirestoreUserDocument(userId, email, phone, ssn) {\n    let fields = {};\n    if (email) fields[\"email\"] = email;\n    if (phone) fields[\"phoneNumber\"] = phone;\n    if (ssn) fields[\"personalId\"] = ssn;\n    const signInMethod = authUser.current.providerData[0].providerId;\n    if (signInMethod) fields[\"signInMethod\"] = signInMethod;\n    const docRef = db.collection(\"users\").doc(userId);\n    try {\n        const doc = await docRef.get();\n        if (doc.exists) {\n            await docRef.update(fields);\n            console.log(`User document ${userId} was successfully updated with these fields: `, fields);\n        } else {\n            // Get and set attribution utm parameters only when creating user doc\n            const utm_campaign = checkCookie(\"utm_campaign\");\n            const utm_source = checkCookie(\"utm_source\");\n            const utm_medium = checkCookie(\"utm_medium\");\n            const utm_term = checkCookie(\"utm_term\");\n            const utm_content = checkCookie(\"utm_content\");\n            let a = {};\n            if (utm_campaign) a[\"utm_campaign\"] = utm_campaign;\n            if (utm_source) a[\"utm_source\"] = utm_source;\n            if (utm_medium) a[\"utm_medium\"] = utm_medium;\n            if (utm_term) a[\"utm_term\"] = utm_term;\n            if (utm_content) a[\"utm_content\"] = utm_content;\n            if (Object.keys(a).length > 0) fields[\"attribution\"] = a;\n            // Create User Document\n            await docRef.set(fields);\n            console.log(`User document was created with id ${userId} and these fields: `, fields);\n            identify(authUser.current, fields);\n            user.current = fields;\n            // Connect referral user from invite cookie only when creating user doc\n            const inputCode = checkCookie(\"invite\");\n            if (inputCode) await (0, $76d021fe719fc46a$export$28c7efcd0a6b27b)(inputCode);\n        }\n    } catch (e) {\n        errorHandler.report(e);\n        console.log(\"Something went wrong:\", e);\n    }\n}\nasync function $cbfb271301266793$export$4c640cb8f728a673(fallbackRedirect) {\n    // User is signed in\n    if (authUser.current) {\n        const email = authUser.current.email || sessionStorage.getItem(\"email\");\n        const phone = authUser.current.phoneNumber || sessionStorage.getItem(\"phoneNumber\");\n        const ssn = authUser.current.personalId || sessionStorage.getItem(\"personalId\");\n        await $cbfb271301266793$var$updateFirestoreUserDocument(authUser.current.uid, email, phone, ssn); //Important that this happens first, since many other functions depend on an existing user document\n    }\n    // If itemCreatedFromAnotherItem in sessionStorage => Back to sell-item\n    if ($cbfb271301266793$var$userIsSellingNewItem()) location.href = \"./sell-item\";\n    else if (fallbackRedirect && typeof fallbackRedirect === \"string\") location.href = fallbackRedirect;\n    else location.href = \"./private\";\n}\nfunction $cbfb271301266793$var$displayPerferredSignInMethod(buttonId) {\n    var outerDiv = document.getElementById(buttonId).parentElement;\n    var innerDiv = document.getElementById(buttonId);\n    preferredSignInMethodDiv.appendChild(outerDiv.removeChild(innerDiv));\n    preferredSignInMethodDiv.style.display = \"block\";\n    showOtherSignInMethodsButton.style.display = \"flex\";\n    otherSignInMethodsDiv.style.display = \"none\";\n}\n//Get preferred sign in method\nconst $cbfb271301266793$var$preferredSignInMethod = (0, $460064d413045c7d$export$5708bb885f22a021)();\nif ($cbfb271301266793$var$preferredSignInMethod) {\n    console.log(\"preferredSignInMethod exist\", $cbfb271301266793$var$preferredSignInMethod);\n    if ($cbfb271301266793$var$preferredSignInMethod === \"google.com\") $cbfb271301266793$var$displayPerferredSignInMethod(\"googleSignInButton\");\n    if ($cbfb271301266793$var$preferredSignInMethod === \"phone\") $cbfb271301266793$var$displayPerferredSignInMethod(\"smsCodeButton\");\n    if ($cbfb271301266793$var$preferredSignInMethod === \"password\") $cbfb271301266793$var$displayPerferredSignInMethod(\"emailAndPasswordButton\");\n}\nif ($cbfb271301266793$var$userIsSellingNewItem()) {\n    const item = JSON.parse(sessionStorage.getItem(\"itemToBeCreatedAfterSignIn\")).item;\n    itemImage.src = item?.images?.enhancedFrontImageSmall || item?.images?.enhancedFrontImage || \"\";\n    notificationText.innerHTML = `För att fullfölja försäljningen av ditt ${item.brand}-plagg behöver du logga in eller skapa konto`;\n    itemToBeCreatedDiv.style.display = \"block\";\n}\n// Disable Webflow form submit\n$(\"#Password-form\").submit(function() {\n    return false;\n});\n$(\"#Choose-password-form\").submit(function() {\n    return false;\n});\nvar $cbfb271301266793$var$form = document.getElementById(\"Phone-number-form\");\n$cbfb271301266793$var$form.addEventListener(\"submit\", $cbfb271301266793$var$phoneSignIn);\nfunction $cbfb271301266793$var$phoneSignIn(event) {\n    event.preventDefault();\n    submitLoadIcon.style.display = \"block\";\n    sendCodeButton.style.display = \"none\";\n    const formPhoneNumber = signinPhoneNumber.value;\n    const phoneNumber = `+46${formPhoneNumber}`;\n    console.log(formPhoneNumber, phoneNumber);\n    const appVerifier = window.recaptchaVerifier;\n    firebase.auth().signInWithPhoneNumber(phoneNumber, appVerifier).then((confirmationResult1)=>{\n        window.confirmationResult = confirmationResult1;\n        console.log(\"V Code\" + window.confirmationResult.verificationId);\n        mobileNumberDiv.style.display = \"none\";\n        verifyDiv.style.display = \"block\";\n    }).catch((error)=>{\n        // Error; SMS not sent\n        // ...\n        //errorMessageDiv.style.display = 'block';\n        submitLoadIcon.style.display = \"none\";\n        errorMessageDiv.innerText = error.message;\n        console.log(\"Error message: \" + error.message);\n        errorHandler.report(error);\n    });\n}\nsigninButton.addEventListener(\"click\", $cbfb271301266793$var$verifyCode);\nsmsCodeButton.addEventListener(\"click\", function() {\n    mobileNumberDiv.style.display = \"block\";\n    orLoginOtherWayDiv.style.display = \"block\";\n    loginAlternativesDiv.style.display = \"none\";\n});\nfunction $cbfb271301266793$var$verifyCode() {\n    const code = verificationCode.value;\n    console.log(\"Verify screen. My code: \" + code);\n    console.log(\"VerificationID\" + confirmationResult.verificationId);\n    confirmationResult.confirm(code).then((result)=>{\n        const user1 = result.user;\n        if (typeof Storage !== \"undefined\") {\n            sessionStorage.setItem(\"userId\", user1.uid);\n            sessionStorage.setItem(\"phone\", user1.phoneNumber);\n        } else console.log(\"Sorry, your browser does not support Web Storage...\");\n        if (result.additionalUserInfo.isNewUser) {\n            emailForTipsDiv.style.display = \"block\";\n            verifyDiv.style.display = \"none\";\n        } else authUser.whenSet($cbfb271301266793$export$4c640cb8f728a673);\n    }).catch((error)=>{\n        console.log(\"My error: \" + error.message);\n        errorHandler.report(error);\n    });\n}\nfunction $cbfb271301266793$var$addEmailAndNavigate() {\n    try {\n        tipsEmailButton.style.display = \"none\";\n        loadingSpinnerDiv.style.display = \"flex\";\n        if (typeof Storage !== \"undefined\") sessionStorage.setItem(\"email\", emailTipsInput.value);\n        else console.log(\"Sorry, your browser does not support Web Storage...\");\n        authUser.whenSet($cbfb271301266793$export$4c640cb8f728a673);\n    } catch (e) {\n        console.log(\"failed to add email\", e);\n        loadingSpinnerDiv.style.display = \"none\";\n        tipsEmailButton.style.display = \"block\";\n        errorHandler.report(e);\n    }\n}\ngoogleSignInButton.addEventListener(\"click\", $cbfb271301266793$var$signInWithGoogle);\ngoogleSignInButton2.addEventListener(\"click\", $cbfb271301266793$var$signInWithGoogle);\nsigninFormsDiv.style.display = \"block\";\nsigninLoadingDiv.style.display = \"none\";\nasync function $cbfb271301266793$var$signInWithGoogle() {\n    googleButtonText.style.display = \"none\";\n    googleButtonLoadingIcon.style.display = \"block\";\n    // [START auth_google_provider_create]\n    var provider = new firebase.auth.GoogleAuthProvider();\n    // [END auth_google_provider_create]\n    //NEW POPUP SIGNIN\n    try {\n        await firebase.auth().signInWithPopup(provider);\n        await authUser.whenSet($cbfb271301266793$export$4c640cb8f728a673);\n    } catch (error) {\n        errorHandler.report(error);\n        const errorText = `[webflow] Error signing in with Google: ${error.code}, ${error.message}, ${error.email}, ${error}`;\n        console.log(errorText);\n    }\n}\nfunction $cbfb271301266793$var$signInWithEmailPassword() {\n    const email = emailAddress.value;\n    const password = emailPassword.value;\n    signInWithEmailButton.style.display = \"none\";\n    passwordLoadIcon.style.display = \"block\";\n    // [START auth_signin_password]\n    firebase.auth().signInWithEmailAndPassword(email, password).then((userCredential)=>{\n        // Signed in\n        const user1 = userCredential.user;\n        window.userId = user1.uid;\n        console.log(\"Logged in user: \", user1.uid);\n        authUser.whenSet(()=>{\n            if (!authUser.current.emailVerified && (0, $460064d413045c7d$export$4be65e66cfa2648a)(\"viewedVerifyEmailDiv\") !== \"true\") $cbfb271301266793$export$4c640cb8f728a673(\"./user-management?mode=sendEmailVerification\");\n            else $cbfb271301266793$export$4c640cb8f728a673();\n        });\n    }).catch((error)=>{\n        errorHandler.report(error);\n        console.log(\"Error message:\", error.code, error.message);\n        if (error.code === \"auth/wrong-password\") {\n            passwordFeedback.innerText = \"Fel l\\xf6senord\";\n            passwordFeedback.style.display = \"block\";\n            signInWithEmailButton.style.display = \"block\";\n            passwordLoadIcon.style.display = \"none\";\n        }\n    });\n// [END auth_signin_password]\n}\nfunction $cbfb271301266793$var$signUpWithEmailPassword() {\n    const email = emailAddress.value;\n    const password = newPassword.value;\n    signUpWithEmailButton.style.display = \"none\";\n    newPasswordLoadIcon.style.display = \"block\";\n    // [START auth_signup_password]\n    firebase.auth().createUserWithEmailAndPassword(email, password).then((userCredential)=>{\n        // Signed in\n        const user1 = userCredential.user;\n        window.userId = user1.uid;\n        console.log(\"Logged in user: \", user1);\n        firebase.auth().currentUser.sendEmailVerification().then(()=>{\n            authUser.whenSet(()=>$cbfb271301266793$export$4c640cb8f728a673(\"./user-management?mode=sendEmailVerification\"));\n        });\n    }).catch((error)=>{\n        errorHandler.report(error);\n        var errorCode = error.code;\n        var errorMessage = error.message;\n        console.log(\"Error message:\", errorCode, errorMessage);\n        newPasswordFeedback.innerText = errorMessage;\n        signUpWithEmailButton.style.display = \"block\";\n        newPasswordLoadIcon.style.display = \"none\";\n    });\n// [END auth_signup_password]\n}\nfunction $cbfb271301266793$var$sendPasswordReset() {\n    const email = emailAddress.value;\n    // [START auth_send_password_reset]\n    firebase.auth().sendPasswordResetEmail(email).then(()=>{\n        // Password reset email sent!\n        console.log(\"Reset password email sent\");\n        forgotPasswordText.innerHTML = `Email skickat till ${email}`;\n    }).catch((error)=>{\n        errorHandler.report(error);\n        var errorCode = error.code;\n        var errorMessage = error.message;\n        console.log(errorCode, errorMessage);\n    });\n// [END auth_send_password_reset]\n}\nfunction $cbfb271301266793$var$checkEmail() {\n    const email = emailAddress.value;\n    console.log(\"emailAddress: \", email);\n    firebase.auth().fetchSignInMethodsForEmail(email).then((signInMethods)=>{\n        if (signInMethods.indexOf(firebase.auth.EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD) != -1) {\n            // User can sign in with email/password.\n            console.log(\"Account exists -> Login with email\");\n            chooseEmailDiv.style.display = \"none\";\n            signinWithEmailDiv.style.display = \"block\";\n        } else {\n            console.log(\"Account doesn't exist -> Create new account\");\n            chooseEmailDiv.style.display = \"none\";\n            choosePasswordDiv.style.display = \"block\";\n        }\n    }).catch((error)=>{\n        errorHandler.report(error);\n        console.log(\"Error message:\", error.code, error.message);\n    });\n}\nemailNextStepButton.addEventListener(\"click\", $cbfb271301266793$var$checkEmail);\ntipsEmailButton.addEventListener(\"click\", $cbfb271301266793$var$addEmailAndNavigate);\nresetPasswordLink.addEventListener(\"click\", $cbfb271301266793$var$sendPasswordReset);\nemailAndPasswordButton.addEventListener(\"click\", function() {\n    chooseEmailDiv.style.display = \"block\";\n    loginAlternativesDiv.style.display = \"none\";\n});\nsignUpWithEmailButton.addEventListener(\"click\", $cbfb271301266793$var$signUpWithEmailPassword);\nsignInWithEmailButton.addEventListener(\"click\", $cbfb271301266793$var$signInWithEmailPassword);\nshowOtherSignInMethodsButton.addEventListener(\"click\", function() {\n    triggerOtherSignInMethodsView.click();\n});\n\n})();\n//# sourceMappingURL=signIn.js.map\n","import {getCookie, getPreferredLogInMethod, setPreferredLogInMethodCookie} from \"./cookieManagement\";\nimport {connectReferralUsers} from \"./referralFunctions\";\n\nwindow.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('sendCodeButton', {\n  'size': 'invisible',\n  'callback': (response) => {\n    // reCAPTCHA solved, allow signInWithPhoneNumber.\n    onSignInSubmit();\n  }\n});\n\nconsole.log('Check onAuthStateChanged: ', new Date());\nfirebase.auth().onAuthStateChanged(async (result) => {\n  console.log(\"onAuthStateChanged callback: \", new Date());\n  const now = new Date().toISOString();\n  if (result) {\n    // Get and set current user\n    const authenticated = result;\n    authUser.current = authenticated;\n    console.log(\"authUser:\", authUser.current);\n    localStorage.setItem('authUserId', authenticated.uid);\n    try {\n      setPreferredLogInMethodCookie(authenticated.providerData[0].providerId);\n      const doc = await db.collection(\"users\").doc(authenticated.uid).get();\n      if (doc.exists) {\n        identify(authenticated, doc.data());\n        console.log(\"user:\", doc.data());\n        user.current = doc.data();\n      }\n      await saveRefreshToken();\n    } catch (error) {\n      errorHandler.report(error);\n      console.log(\"Error getting document:\", error);\n    }\n  } else {\n    console.log('No user');\n    localStorage.removeItem('authUserId')\n    // Go to landing page if no user and on logged in pages\n    const path = window.location.pathname;\n    // Latest page view for logged out users\n    analytics.identify({ latestPageView: now });\n\n    if (path === \"/private\" || path === \"/personal-id-form\" || path === \"/address-form\" || path === \"/item\" || path === \"/ship-item\" || path === \"/edit-item\" || path === \"/order-bags\") {\n      location.href = './';\n    }\n    if (path === \"/\"){\n      headerLoginLoading.style.display = 'none';\n      headerLoginButton.style.display = 'flex';\n    }\n  }\n});\n\nasync function saveRefreshToken() {\n  const refreshToken = authUser.current.refreshToken\n  const idToken = await authUser.current.getIdToken();\n  try {\n    // TODO: Change to maiapp.se to go live\n    return await fetch('https://api.shh-test.page/maiappAuth', {\n      credentials: 'include',\n      headers: {\n        'Authorization': 'Bearer ' + idToken,\n        'X-Mai-Refresh-Token': refreshToken,\n      }\n    });\n  } catch (ex) {\n    errorHandler.report(ex);\n    console.log('Error setting cookie with refresh token', ex);\n  }\n}\n\nasync function loginWithCookieToken() {\n  const cookie = getCookie('maiAuth');\n  if (!cookie?.length) {\n    return;\n  }\n  if (authUser.current) {\n    return; // No need to log in\n  }\n  try {\n    // Get an id token that can be validated by the firebase function maiappAuth\n    const refreshResponse = await fetch(`https://securetoken.googleapis.com/v1/token?key=${firebaseConfig.apiKey}`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        grant_type: 'refresh_token',\n        refresh_token: cookie\n      })\n    });\n    const refreshJson = await refreshResponse.json();\n    if (refreshJson.id_token && !authUser.current) {\n      // Get a custom token that we can use to sign in\n      const customTokenResponse = await fetch(`https://api.shh-test.page/maiappAuth?id_token=${refreshJson.id_token}`);\n      const customTokenJson = await customTokenResponse.json();\n      if (customTokenJson.status === 'customToken' && !authUser.current) {\n        await firebase.auth().signInWithCustomToken(customTokenJson.customToken);\n      }\n    }\n  } catch (ex) {\n    errorHandler.report(ex);\n    console.log('Failed to log in using saved token', ex);\n  }\n}\n\nloginWithCookieToken();\n\nfunction userIsSellingNewItem() {\n  return sessionStorage.getItem('itemToBeCreatedAfterSignIn') &&\n    (document.referrer.includes('/sell-item') || document.referrer.includes('/item-valuation'));\n}\n\nasync function updateFirestoreUserDocument(userId, email, phone, ssn) {\n  let fields = {};\n  if (email) { fields[\"email\"] = email; }\n  if (phone) { fields[\"phoneNumber\"] = phone; }\n  if (ssn) { fields[\"personalId\"] = ssn; }\n  const signInMethod = authUser.current.providerData[0].providerId;\n  if (signInMethod) { fields[\"signInMethod\"] = signInMethod; }\n  const docRef = db.collection(\"users\").doc(userId);\n\n  try {\n    const doc = await docRef.get();\n    if (doc.exists) {\n      await docRef.update(fields);\n      console.log(`User document ${userId} was successfully updated with these fields: `, fields);\n    } else {\n      // Get and set attribution utm parameters only when creating user doc\n      const utm_campaign = checkCookie(\"utm_campaign\");\n      const utm_source = checkCookie(\"utm_source\");\n      const utm_medium = checkCookie(\"utm_medium\");\n      const utm_term = checkCookie(\"utm_term\");\n      const utm_content = checkCookie(\"utm_content\");\n      let a = {};\n      if (utm_campaign) { a[\"utm_campaign\"] = utm_campaign; }\n      if (utm_source) { a[\"utm_source\"] = utm_source; }\n      if (utm_medium) { a[\"utm_medium\"] = utm_medium; }\n      if (utm_term) { a[\"utm_term\"] = utm_term; }\n      if (utm_content) { a[\"utm_content\"] = utm_content; }\n      if (Object.keys(a).length > 0) { fields[\"attribution\"] = a }\n\n      // Create User Document\n      await docRef.set(fields);\n      console.log(`User document was created with id ${userId} and these fields: `, fields);\n      identify(authUser.current, fields);\n      user.current = fields;\n\n      // Connect referral user from invite cookie only when creating user doc\n      const inputCode = checkCookie(\"invite\");\n      if (inputCode) {\n        await connectReferralUsers(inputCode);\n      }\n    }\n  } catch (e) {\n    errorHandler.report(e);\n    console.log(\"Something went wrong:\", e);\n  }\n}\n\nexport async function signedInNextStep(fallbackRedirect) {\n  // User is signed in\n  if (authUser.current) {\n    const email = authUser.current.email || sessionStorage.getItem(\"email\");\n    const phone = authUser.current.phoneNumber || sessionStorage.getItem(\"phoneNumber\");\n    const ssn = authUser.current.personalId || sessionStorage.getItem(\"personalId\");\n    await updateFirestoreUserDocument(authUser.current.uid, email, phone, ssn); //Important that this happens first, since many other functions depend on an existing user document\n  }\n  // If itemCreatedFromAnotherItem in sessionStorage => Back to sell-item\n  if (userIsSellingNewItem()) {\n    location.href = './sell-item';\n  } else if (fallbackRedirect && typeof fallbackRedirect === 'string') {\n    location.href = fallbackRedirect;\n  } else {\n    location.href = './private';\n  }\n}\n\nfunction displayPerferredSignInMethod(buttonId) {\n  var outerDiv = document.getElementById(buttonId).parentElement;\n  var innerDiv = document.getElementById(buttonId);\n  preferredSignInMethodDiv.appendChild(outerDiv.removeChild(innerDiv));\n  preferredSignInMethodDiv.style.display = 'block';\n  showOtherSignInMethodsButton.style.display = 'flex';\n  otherSignInMethodsDiv.style.display = 'none';\n}\n\n//Get preferred sign in method\nconst preferredSignInMethod = getPreferredLogInMethod();\n\nif (preferredSignInMethod) {\n  console.log(\"preferredSignInMethod exist\", preferredSignInMethod);\n  if (preferredSignInMethod === 'google.com') {\n    displayPerferredSignInMethod('googleSignInButton');\n  }\n  if (preferredSignInMethod === 'phone') {\n    displayPerferredSignInMethod('smsCodeButton');\n  }\n  if (preferredSignInMethod === 'password') {\n    displayPerferredSignInMethod('emailAndPasswordButton');\n  }\n}\n\nif (userIsSellingNewItem()) {\n  const item = JSON.parse(sessionStorage.getItem('itemToBeCreatedAfterSignIn')).item;\n  itemImage.src = item?.images?.enhancedFrontImageSmall || item?.images?.enhancedFrontImage || '';\n  notificationText.innerHTML = `För att fullfölja försäljningen av ditt ${item.brand}-plagg behöver du logga in eller skapa konto`;\n  itemToBeCreatedDiv.style.display = 'block';\n}\n\n// Disable Webflow form submit\n$('#Password-form').submit(function () {\n  return false;\n});\n$('#Choose-password-form').submit(function () {\n  return false;\n});\n\nvar form = document.getElementById(\"Phone-number-form\");\nform.addEventListener('submit', phoneSignIn);\n\nfunction phoneSignIn(event) {\n  event.preventDefault();\n\n  submitLoadIcon.style.display = 'block';\n  sendCodeButton.style.display = 'none';\n  const formPhoneNumber = signinPhoneNumber.value;\n  const phoneNumber = `+46${formPhoneNumber}`;\n\n  console.log(formPhoneNumber, phoneNumber);\n\n  const appVerifier = window.recaptchaVerifier;\n\n  firebase.auth().signInWithPhoneNumber(phoneNumber, appVerifier)\n    .then((confirmationResult) => {\n      window.confirmationResult = confirmationResult;\n      console.log('V Code' + window.confirmationResult.verificationId);\n      mobileNumberDiv.style.display = 'none';\n      verifyDiv.style.display = 'block';\n\n    }).catch((error) => {\n    // Error; SMS not sent\n    // ...\n    //errorMessageDiv.style.display = 'block';\n    submitLoadIcon.style.display = 'none';\n    errorMessageDiv.innerText = error.message;\n    console.log('Error message: ' + error.message);\n    errorHandler.report(error);\n  });\n}\n\nsigninButton.addEventListener('click', verifyCode);\nsmsCodeButton.addEventListener('click', function () {\n  mobileNumberDiv.style.display = 'block';\n  orLoginOtherWayDiv.style.display = 'block';\n  loginAlternativesDiv.style.display = 'none';\n});\n\nfunction verifyCode() {\n  const code = verificationCode.value;\n  console.log('Verify screen. My code: ' + code);\n  console.log('VerificationID' + confirmationResult.verificationId);\n  confirmationResult.confirm(code).then((result) => {\n    const user = result.user;\n\n    if (typeof (Storage) !== \"undefined\") {\n      sessionStorage.setItem(\"userId\", user.uid);\n      sessionStorage.setItem(\"phone\", user.phoneNumber);\n    } else {\n      console.log(\"Sorry, your browser does not support Web Storage...\");\n    }\n\n    if (result.additionalUserInfo.isNewUser) {\n      emailForTipsDiv.style.display = 'block';\n      verifyDiv.style.display = 'none';\n    } else {\n      authUser.whenSet(signedInNextStep);\n    }\n  }).catch((error) => {\n    console.log('My error: ' + error.message);\n    errorHandler.report(error);\n  });\n}\n\n\nfunction addEmailAndNavigate() {\n  try {\n    tipsEmailButton.style.display = 'none'\n    loadingSpinnerDiv.style.display = 'flex'\n    if (typeof (Storage) !== \"undefined\") {\n      sessionStorage.setItem(\"email\", emailTipsInput.value);\n    } else {\n      console.log(\"Sorry, your browser does not support Web Storage...\");\n    }\n\n    authUser.whenSet(signedInNextStep);\n  } catch (e) {\n    console.log('failed to add email', e)\n    loadingSpinnerDiv.style.display = 'none'\n    tipsEmailButton.style.display = 'block'\n    errorHandler.report(e);\n  }\n}\ngoogleSignInButton.addEventListener('click', signInWithGoogle);\ngoogleSignInButton2.addEventListener('click', signInWithGoogle);\nsigninFormsDiv.style.display = 'block';\nsigninLoadingDiv.style.display = 'none';\n\nasync function signInWithGoogle() {\n  googleButtonText.style.display = 'none';\n  googleButtonLoadingIcon.style.display = 'block';\n  // [START auth_google_provider_create]\n  var provider = new firebase.auth.GoogleAuthProvider();\n  // [END auth_google_provider_create]\n\n\n  //NEW POPUP SIGNIN\n  try {\n    await firebase.auth().signInWithPopup(provider)\n    await authUser.whenSet(signedInNextStep);\n  } catch (error) {\n    errorHandler.report(error);\n    const errorText = `[webflow] Error signing in with Google: ${error.code}, ${error.message}, ${error.email}, ${error}`;\n    console.log(errorText);\n  }\n}\n\nfunction signInWithEmailPassword() {\n  const email = emailAddress.value;\n  const password = emailPassword.value;\n  signInWithEmailButton.style.display = 'none';\n  passwordLoadIcon.style.display = 'block';\n  // [START auth_signin_password]\n  firebase.auth().signInWithEmailAndPassword(email, password)\n    .then((userCredential) => {\n      // Signed in\n      const user = userCredential.user;\n      window.userId = user.uid;\n      console.log(\"Logged in user: \", user.uid);\n      authUser.whenSet(() => {\n        if (!authUser.current.emailVerified && getCookie('viewedVerifyEmailDiv') !== 'true') {\n          signedInNextStep('./user-management?mode=sendEmailVerification');\n        } else {\n          signedInNextStep();\n        }\n      });\n    })\n    .catch((error) => {\n      errorHandler.report(error);\n      console.log(\"Error message:\", error.code, error.message);\n      if (error.code === \"auth/wrong-password\") {\n        passwordFeedback.innerText = \"Fel lösenord\";\n        passwordFeedback.style.display = 'block';\n        signInWithEmailButton.style.display = 'block';\n        passwordLoadIcon.style.display = 'none';\n      }\n    });\n  // [END auth_signin_password]\n}\n\nfunction signUpWithEmailPassword() {\n  const email = emailAddress.value;\n  const password = newPassword.value;\n  signUpWithEmailButton.style.display = 'none';\n  newPasswordLoadIcon.style.display = 'block';\n  // [START auth_signup_password]\n  firebase.auth().createUserWithEmailAndPassword(email, password)\n    .then((userCredential) => {\n      // Signed in\n      const user = userCredential.user;\n      window.userId = user.uid;\n      console.log(\"Logged in user: \", user);\n      firebase.auth().currentUser.sendEmailVerification().then(() => {\n        authUser.whenSet(() => signedInNextStep('./user-management?mode=sendEmailVerification'));\n      });\n    })\n    .catch((error) => {\n      errorHandler.report(error);\n      var errorCode = error.code;\n      var errorMessage = error.message;\n      console.log(\"Error message:\", errorCode, errorMessage);\n      newPasswordFeedback.innerText = errorMessage;\n      signUpWithEmailButton.style.display = 'block';\n      newPasswordLoadIcon.style.display = 'none';\n    });\n  // [END auth_signup_password]\n}\n\nfunction sendPasswordReset() {\n  const email = emailAddress.value;\n  // [START auth_send_password_reset]\n  firebase.auth().sendPasswordResetEmail(email)\n    .then(() => {\n      // Password reset email sent!\n      console.log(\"Reset password email sent\");\n      forgotPasswordText.innerHTML = `Email skickat till ${email}`;\n    })\n    .catch((error) => {\n      errorHandler.report(error);\n      var errorCode = error.code;\n      var errorMessage = error.message;\n      console.log(errorCode, errorMessage);\n    });\n  // [END auth_send_password_reset]\n}\n\nfunction checkEmail() {\n  const email = emailAddress.value;\n  console.log(\"emailAddress: \", email);\n  firebase.auth().fetchSignInMethodsForEmail(email)\n    .then((signInMethods) => {\n      if (signInMethods.indexOf(\n        firebase.auth.EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD) != -1) {\n        // User can sign in with email/password.\n        console.log(\"Account exists -> Login with email\");\n        chooseEmailDiv.style.display = 'none';\n        signinWithEmailDiv.style.display = 'block';\n      } else {\n        console.log(\"Account doesn't exist -> Create new account\");\n        chooseEmailDiv.style.display = 'none';\n        choosePasswordDiv.style.display = 'block';\n      }\n    })\n    .catch((error) => {\n      errorHandler.report(error);\n      console.log(\"Error message:\", error.code, error.message);\n    });\n}\n\nemailNextStepButton.addEventListener('click', checkEmail);\ntipsEmailButton.addEventListener('click', addEmailAndNavigate)\nresetPasswordLink.addEventListener('click', sendPasswordReset);\nemailAndPasswordButton.addEventListener('click', function () {\n  chooseEmailDiv.style.display = 'block';\n  loginAlternativesDiv.style.display = 'none';\n});\nsignUpWithEmailButton.addEventListener('click', signUpWithEmailPassword);\nsignInWithEmailButton.addEventListener('click', signInWithEmailPassword);\nshowOtherSignInMethodsButton.addEventListener('click', function () {\n  triggerOtherSignInMethodsView.click();\n});\n","import { getParamsObject } from \"./general\";\n\nexport function setCookie(cname, cvalue, exdays) {\n    const d = new Date();\n    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));\n    let expires = \"expires=\" + d.toUTCString();\n    cvalue = cvalue.replaceAll('+', ' ');\n    cvalue = encodeURIComponent(cvalue);\n    document.cookie = cname + \"=\" + cvalue + \";\" + expires + \";path=/\";\n    //console.log(\"Cookie set: \", cname + \"=\" + cvalue);\n}\n\nexport function deleteCookie(cname) {\n  document.cookie = cname + '=; Max-Age=-99999999;';\n}\n\nexport function getCookie(cname) {\n    let name = cname + \"=\";\n    let ca = document.cookie.split(';');\n    for (let i = 0; i < ca.length; i++) {\n        let c = ca[i];\n        while (c.charAt(0) == ' ') {\n            c = c.substring(1);\n        }\n        if (c.indexOf(name) == 0) {\n            c = c.substring(name.length, c.length);\n            return decodeURIComponent(c);\n        }\n    }\n    return \"\";\n}\n\nconst preferredLoginMethodCookieName = 'preferredLoginMethod';\n\nexport const getPreferredLogInMethod = () => getCookie(preferredLoginMethodCookieName);\n\nexport function setPreferredLogInMethodCookie(providerId) {\n    setCookie(preferredLoginMethodCookieName, providerId, 6000);\n}\n","import {deleteCookie} from \"./cookieManagement\";\n\nexport function getParamsObject() {\n  // Get params\n  var queryStr = window.location.search;\n  var paramPairs = queryStr.substring(1).split('&');\n  var params = {};\n  for (var i = 0; i < paramPairs.length; i++) {\n    var parts = paramPairs[i].split('=');\n    params[parts[0]] = decodeURIComponent(parts[1]);\n  }\n  return params;\n}\n\n\n\nfunction signOut() {\n    firebase.auth().signOut().then(() => {\n        console.log('User signed out');\n        authUser.current = null;\n        user.current = null;\n        userId = null;\n        location.href = '/';\n        deleteCookie('maiAuth');\n    }).catch((error) => {\n        errorHandler.report(error);\n        console.log(error);\n    });\n}\n\nexport function setFormAddressFields(user) {\n    document.getElementById(\"addressFirstName\").value = user.addressFirstName || '';\n    document.getElementById(\"addressFirstName\").dispatchEvent(new Event('input'));\n    document.getElementById(\"addressLastName\").value = user.addressLastName || '';\n    document.getElementById(\"addressLastName\").dispatchEvent(new Event('input'));\n    document.getElementById(\"addressStreetAddress\").value = user.addressStreetAddress || '';\n    document.getElementById(\"addressStreetAddress\").dispatchEvent(new Event('input'));\n    document.getElementById(\"addressCO\").value = user.addressCO || '';\n    document.getElementById(\"addressCO\").dispatchEvent(new Event('input'));\n    document.getElementById(\"addressPostalCode\").value = user.addressPostalCode || '';\n    document.getElementById(\"addressPostalCode\").dispatchEvent(new Event('input'));\n    document.getElementById(\"addressCity\").value = user.addressCity || '';\n    document.getElementById(\"addressCity\").dispatchEvent(new Event('input'));\n    document.getElementById(\"addressDoorCode\").value = user.addressDoorCode || '';\n    document.getElementById(\"addressDoorCode\").dispatchEvent(new Event('input'));\n}\nexport function getFormAddressFields() {\n    let addressFirstName = document.getElementById(\"addressFirstName\").value;\n    let addressLastName = document.getElementById(\"addressLastName\").value;\n    let addressStreetAddress = document.getElementById(\"addressStreetAddress\").value;\n    let addressCO = document.getElementById(\"addressCO\").value;\n    let addressPostalCode = document.getElementById(\"addressPostalCode\").value;\n    let addressCity = document.getElementById(\"addressCity\").value;\n    let addressDoorCode = document.getElementById(\"addressDoorCode\").value;\n\n    addressFirstName = addressFirstName ? addressFirstName.trim().charAt(0).toUpperCase() + addressFirstName.trim().slice(1) : \"\";\n    addressLastName = addressLastName ? addressLastName.trim().charAt(0).toUpperCase() + addressLastName.trim().slice(1) : \"\";\n    addressStreetAddress = addressStreetAddress ? addressStreetAddress.trim().charAt(0).toUpperCase() + addressStreetAddress.trim().slice(1) : \"\";\n    addressCO = addressCO ? addressCO.trim() : \"\";\n    addressPostalCode = addressPostalCode ? addressPostalCode.trim().replace(/\\D/g, '') : \"\";\n    addressCity = addressCity ? addressCity.trim().charAt(0).toUpperCase() + addressCity.trim().slice(1) : \"\";\n    addressDoorCode = addressDoorCode ? addressDoorCode.trim() : \"\";\n    return { addressFirstName, addressLastName, addressStreetAddress, addressCO, addressPostalCode, addressCity, addressDoorCode };\n}\n\n\n// Validate Swedish Social Security Number (personnummer) using checksum\n//   Note: this is somewhat simplified because it does not take into account\n//   that the date of the number is valid (e.g. \"000000-0000\" does return as true)\nexport function isValidSwedishSsn(ssn) {\n    ssn = ssn\n        .replace(/\\D/g, \"\")     // strip out all but digits\n        .split(\"\")              // convert string to array\n        .reverse()              // reverse order for Luhn\n        .slice(0, 10);          // keep only 10 digits (i.e. 1977 becomes 77)\n\n    // verify we got 10 digits, otherwise it is invalid\n    if (ssn.length !== 10) {\n        return false;\n    }\n    const sum = ssn.map((n) => Number(n))\n        .reduce((previous, current, index) => {\n            if (index % 2) current *= 2;\n            if (current > 9) current -= 9;\n            return previous + current;\n        });\n    return 0 === sum % 10;\n}\n\n\nexport function formatPersonalId(personalIdInput) {\n    let personalId = personalIdInput.replace('-', '');\n    if (personalId.length !== 12 && (personalId.substring(0, 2) !== '19' || personalId.substring(0, 2) !== '20')) {\n        if (Number(personalId.substring(0, 2)) <= 99 && Number(personalId.substring(0, 2)) > 25) {\n            personalId = \"19\" + personalId;\n        } else {\n            personalId = \"20\" + personalId;\n        }\n    }\n    if (personalId.length === 12) {\n        return personalId;\n    }\n    return null;\n}\n\nexport function itemCoverImage(item) {\n    const images = item.images;\n    if (images.modelImage) {\n        return images.modelImageSmall || images.modelImage\n    }\n    if (images.coverImage) {\n        return images.coverImageSmall || images.coverImage\n    }\n    if (images.enhancedFrontImage) {\n        return images.enhancedFrontImageSmall || images.enhancedFrontImage\n    }\n    return images.frontImageSmall || images.frontImage\n}\n\n\nexport function shareCode() {\n    const code = user.current.referralData.referralCode;\n    const text = `Hej, jag vill tipsa om Mai för att rensa ur garderoben. Mai är en tjänst som hjälper dig att sälja dina kläder på ett enkelt sätt. Man tar bara bilder på sina plagg, sedan sköter Mai resten - såsom värdering, annonsering på flera plattformar, kontakt med köpare och frakt när det blir sålt. Man får själv behålla 80% av vinsten, och blir det inte sålt kostar det ingenting.\\n\\nOm du registrerar dig med min kod (följ länken) och provar sälja ett plagg inom 7 dagar får du behålla 100% av vinsten för det första plagget (istället för 80%). Min kod: ${code}\\n\\nLäs mer och använd min kod här:`\n    if (navigator.share) {\n        navigator.share({\n            text: text,\n            url: `https://maiapp.se/?invite=${code}`\n        }).then(() => { console.log('Thanks for sharing!'); }).catch((e) => {\n            console.error(e);\n            errorHandler.report(e);\n        });\n    } else {\n        console.log(\"Browser doesn't support navigator.share => Copy to clipboard!\");\n        const shareText = text + \"\\n\" + `https://maiapp.se/?invite=${code}`;\n        navigator.clipboard.writeText(shareText);\n        linkCopiedBanner.style.display = 'flex';\n        setTimeout(function () { linkCopiedBanner.style.display = 'none'; }, 1500);\n    }\n}\n","// REFERRAL PROGRAM FUNCTIONS\nimport {deleteCookie} from \"./cookieManagement\";\n\nexport async function showReferralSection() {\n  if (user.current?.referralData?.referralCode) {\n    document.getElementById(\"myReferralCodeText\").innerHTML = user.current.referralData.referralCode;\n    if (user.current?.referralData?.activatedReferredUsersCount > 0) {\n      // shareCodeState 'block', but should also show the bonus received... TODO\"... Eller förresten, detta ska nog ligga på en referral sida + SMS\n      shareCodeState.style.display = 'block';\n    } else {\n      shareCodeState.style.display = 'block';\n    }\n  }\n  referralSection.style.display = 'block';\n}\n\nexport async function showBonusSection() {\n  const userCreatedDate = new Date(authUser.current.metadata.creationTime);\n  const now = new Date();\n  let daysDiff = (now.getTime() - userCreatedDate.getTime()) / (1000 * 3600 * 24);\n  console.log(\"Days since user registered\", daysDiff);\n  const referralData = user.current?.referralData;\n\n  if (referralData && referralData?.referredBy && !referralData?.referredByBonusPaid && !referralData?.referredByDiscountUsed) { //TODO: Behöver 'referredByDiscountUsed' till FS för att kunna se om de redan löst in 1 kommissionsfri försäljning\n    // Get inviters first name\n    const inviter = referralData?.referredBy;\n    const res = await firebase.app().functions(\"europe-west3\").httpsCallable('referrerName')({ referrerId: inviter });\n    console.log('referrerName result', res);\n    await showActivatedBonus(res?.data?.name, res?.data?.code);\n    bonusSection.style.display = 'block';\n    return;\n  }\n  \n  if ((user.current?.referralData?.referredBy ? false : true) && daysDiff <= 30) {\n    if (bonusActivatedState.style.display === 'none') {\n      enterCodeState.style.display = 'block';\n      bonusSection.style.display = 'block';\n    }\n  }\n}\n\nasync function showActivatedBonus(referrerName, referrerCode) {\n  console.log('showActivatedBonus run');\n  let bonusNameText = 'BONUS';\n  if (referrerName && referrerName !== 'Mai') {\n    bonusNameText = \"BONUS - INBJUDEN AV \" + referrerName.toUpperCase();\n  } else if (referrerCode) {\n    bonusNameText = \"BONUS - \" + referrerCode.toUpperCase();\n  }\n  if (document.getElementById(\"bonusSection\")) {\n    document.getElementById(\"bonusName\").innerHTML = bonusNameText;\n    document.getElementById(\"bonusActivatedState\").style.display = 'block';\n    document.getElementById(\"enterCodeState\").style.display = 'none';\n    bonusSection.style.display = 'block';\n  }\n}\n\nexport async function createReferralCode() {\n  if (!user.current?.referralData?.referralCode) {\n    const referralCode = await firebase.app().functions(\"europe-west3\").httpsCallable('setUserReferralCode')();\n    console.log(\"New referral code stored: \", referralCode?.data?.referralCode);\n    user.current.referralData = { ...user.current.referralData, referralCode: referralCode?.data?.referralCode };\n    await showReferralSection();\n  }\n}\n\nasync function showReferralErrorMessage(msg) {\n  // Show message they can't add their own code\n  errorBannerMessage.innerHTML = msg ? msg : errorBannerMessage.innerHTML;\n  errorMessageBanner.style.display = 'flex';\n  saveRefCodeLoadingDiv.style.display = 'none';\n  saveReferralCodeButton.style.display = 'inline-block';\n  //saveReferralCodeButton.click(); //To trigger animation\n  setTimeout(function () {\n    errorMessageBanner.style.display = 'none';\n  }, 2500);\n}\n\nexport async function connectReferralUsers(inputCode) {\n  inputCode = inputCode.trim().toUpperCase();\n  if (inputCode === user.current?.referralData?.referralCode) {\n    await showReferralErrorMessage('Du kan inte aktivera din egen kod');\n    return\n  }\n\n  // Find user with matching referral code and connect users\n  try {\n    const res = await firebase.app().functions(\"europe-west3\").httpsCallable('connectReferralUser')({ code: inputCode })\n    deleteCookie('invite');\n    console.log('connecReferralUser response: ', res);\n    if (res?.data?.code === 400) { //User already used a referral\n      return \n    }\n    if (res?.data?.name) {\n      await showActivatedBonus(res?.data?.name, inputCode);\n      console.log(\"Referral connection successfully stored\");\n    } else {\n      console.log(\"Failed to use referral code\", res?.data);\n      await showReferralErrorMessage(`Koden ${inputCode} finns inte`);\n    }\n  } catch (e) {\n    errorHandler.report(e);\n    console.log(\"Failed to use referral code\", e);\n  }\n}\n"],"names":["$460064d413045c7d$export$4be65e66cfa2648a","cname","name","ca","document","cookie","split","i","length","c","charAt","substring","indexOf","decodeURIComponent","$460064d413045c7d$var$preferredLoginMethodCookieName","$76d021fe719fc46a$var$showActivatedBonus","referrerName","referrerCode","console","log","bonusNameText","toUpperCase","getElementById","innerHTML","style","display","bonusSection","$76d021fe719fc46a$var$showReferralErrorMessage","msg","errorBannerMessage","errorMessageBanner","saveRefCodeLoadingDiv","saveReferralCodeButton","setTimeout","$76d021fe719fc46a$export$28c7efcd0a6b27b","inputCode","trim","user","current","referralData","referralCode","res","firebase","app","functions","httpsCallable","code","data","e","errorHandler","report","$cbfb271301266793$var$saveRefreshToken","refreshToken","authUser","idToken","getIdToken","fetch","credentials","headers","ex","$cbfb271301266793$var$userIsSellingNewItem","sessionStorage","getItem","referrer","includes","$cbfb271301266793$var$updateFirestoreUserDocument","userId","email","phone","ssn","fields","signInMethod","providerData","providerId","docRef","db","collection","doc","get","exists","update","utm_campaign","checkCookie","utm_source","utm_medium","utm_term","utm_content","a","Object","keys","set","identify","$cbfb271301266793$export$4c640cb8f728a673","fallbackRedirect","phoneNumber","personalId","uid","location","href","$cbfb271301266793$var$displayPerferredSignInMethod","buttonId","outerDiv","parentElement","innerDiv","preferredSignInMethodDiv","appendChild","removeChild","showOtherSignInMethodsButton","otherSignInMethodsDiv","window","recaptchaVerifier","auth","RecaptchaVerifier","response","onSignInSubmit","Date","onAuthStateChanged","result","now","toISOString","localStorage","setItem","authenticated","$460064d413045c7d$export$110700823644f4a6","cvalue","exdays","d","setTime","getTime","expires","toUTCString","encodeURIComponent","replaceAll","error","removeItem","path","pathname","analytics","latestPageView","headerLoginLoading","headerLoginButton","$cbfb271301266793$var$loginWithCookieToken","refreshResponse","firebaseConfig","apiKey","method","body","JSON","stringify","grant_type","refresh_token","refreshJson","json","id_token","customTokenResponse","customTokenJson","status","signInWithCustomToken","customToken","$cbfb271301266793$var$preferredSignInMethod","item","parse","itemImage","src","images","enhancedFrontImageSmall","enhancedFrontImage","notificationText","brand","itemToBeCreatedDiv","$cbfb271301266793$var$signInWithGoogle","googleButtonText","googleButtonLoadingIcon","provider","GoogleAuthProvider","signInWithPopup","whenSet","errorText","message","$","submit","$cbfb271301266793$var$form","addEventListener","event","preventDefault","submitLoadIcon","sendCodeButton","formPhoneNumber","signinPhoneNumber","value","appVerifier","signInWithPhoneNumber","then","confirmationResult1","confirmationResult","verificationId","mobileNumberDiv","verifyDiv","catch","errorMessageDiv","innerText","signinButton","verificationCode","confirm","user1","Storage","additionalUserInfo","isNewUser","emailForTipsDiv","smsCodeButton","orLoginOtherWayDiv","loginAlternativesDiv","googleSignInButton","googleSignInButton2","signinFormsDiv","signinLoadingDiv","emailNextStepButton","emailAddress","fetchSignInMethodsForEmail","signInMethods","EmailAuthProvider","EMAIL_PASSWORD_SIGN_IN_METHOD","chooseEmailDiv","signinWithEmailDiv","choosePasswordDiv","tipsEmailButton","loadingSpinnerDiv","emailTipsInput","resetPasswordLink","sendPasswordResetEmail","forgotPasswordText","emailAndPasswordButton","signUpWithEmailButton","password","newPassword","newPasswordLoadIcon","createUserWithEmailAndPassword","userCredential","currentUser","sendEmailVerification","errorCode","errorMessage","newPasswordFeedback","signInWithEmailButton","emailPassword","passwordLoadIcon","signInWithEmailAndPassword","emailVerified","passwordFeedback","triggerOtherSignInMethodsView","click"],"version":3,"file":"signIn.js.map"}