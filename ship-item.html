<script>
    function loadItem(itemId) {
        console.log(`loadItem(${itemId})`);
        db.collection("items").doc(itemId)
            .get().then((doc) => {
                if (doc.exists) {
                    console.log("Item data:", doc.data());
                    data = doc.data();
                    const brand = data.brand;
                    const images = data.images;
                    let imgUrl = images.frontImageSmall || images.frontImage;
                    const category = data.category ? data.category : "";
                    const postnordQrCode = data.postnordQrCode;
                    const fn = data.buyerFirstName || '';
                    const ln = data.buyerLastName || '';
                    const street = data.buyerAddressStreetAddress || '';
                    const postalCode = data.buyerAddressPostalCode || '';
                    const city = data.buyerAddressCity || '';
                    const shippingMethod = data.shippingMethod;
                    const soldPlatform = data.soldPlatform;

                    pageTitleText.innerHTML = `Skicka ${brand.trim()}-${category.trim().toLowerCase()}`;
                    //buyerAddressDiv.innerHTML = `${fn.trim()} ${ln.trim()}<br>${street.trim()}<br>${postalCode.trim()} ${city.trim()}`; // Show full address
                    buyerAddressDiv.innerHTML = `${fn.trim()} ${ln.trim()}<br>i ${city.trim()}`; // Only show name and city
                    itemImageDiv.style.backgroundImage = `url('${imgUrl}')`;

                    if (shippingMethod === 'Service point') {
                        if (!(soldPlatform === 'Vestiaire Collective' || soldPlatform === 'Grailed') && postnordQrCode) {
                            qrCodeImage.src = postnordQrCode;
                            qrCodeDiv.style.display = "block";
                            howToShipQrDiv.style.display = "block";
                        } else {
                            howToShipNoQrDiv.style.display = "block";
                            dividerTop.style.display = "none";
                        }
                    } else if (shippingMethod === 'Pickup') {
                        howToShipPickupDiv.style.display = "block";
                        dividerTop.style.display = "none";
                    }

                    pageTitleText.style.display = "block";
                    contentDiv.style.display = "block";
                    loadingDiv.style.display = "none";
                } else {
                    console.log("No such document!");
                }
            }).catch((error) => {
                console.log("Error getting item document:", error);
            });
    }

    // Load item
    loadItem(params.id);
</script>