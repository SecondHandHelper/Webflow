<script>
    var userId;
    var email;
    var phone;
</script>
<script>
    function main() {
        userId = authUser.uid;
        email = authUser.email;
        phone = authUser.phoneNumber;
        emailVerified = authUser.emailVerified;
        updateIC(userId, email, phone);
        askForAdditionalUserDetails(userId);
        updateFirestoreUserDocument(userId, email, phone);
        emptyListsInnerHTML();
        loadSoldByOthers(userId);
        buildCardLists(userId);
        if (!emailVerified && email) {
            window.location.replace('./user-management?mode=sendEmailVerification');
        }
        // Create referral code
        if (user.addressFirstName && user.addressLastName && !user?.referralData?.referralCode) {
            createReferralCode();
        }
        showReferralSection();
    }
</script>
<script>
    //TEST AREA ===== TEST AREA =====TEST AREA =====TEST AREA =====TEST AREA =====TEST AREA =====TEST AREA =====

    //TEST AREA ===== TEST AREA =====TEST AREA =====TEST AREA =====TEST AREA =====TEST AREA =====TEST AREA =====
</script>
<script>
    window.addEventListener('load', function () {
        signoutButton.addEventListener('click', signOut);
        bookPickupForm.addEventListener("submit", bookPickup);
        closePickupToastIcon.addEventListener("click", closePickupToast);
        closeFeedbackFormButton.addEventListener("click", closeFeedbackForm);
        happySmileyButton.addEventListener("click", function () { setHappinessRate(3); }, false);
        neutralSmileyButton.addEventListener("click", function () { setHappinessRate(2); }, false);
        angrySmileyButton.addEventListener("click", function () { setHappinessRate(1); }, false);
        feedbackForm.addEventListener("submit", storeFeedback);
        saveReferralCodeButton.addEventListener("click", connectReferralUsers);
        referralCodeInput.addEventListener("input", function () { saveReferralCodeButton.style.display = 'inline-block'; });
    });

    shareCodeButton.addEventListener('click', event => {
        const code = user.referralData.referralCode;
        const text = `Hej! Jag vill bjuda in dig till Mai. Använd min kod ${code} när du skapat ett konto och få 100 kr i välkomstgåva när du säljer ditt första plagg.`
        if (navigator.share) {
            navigator.share({
                text: text,
                url: 'https://maiapp.se'
            }).then(() => { console.log('Thanks for sharing!'); }).catch(console.error);
        } else {
            // fallback
            console.log("Browser doesn't support navigator.share => Copy to clipboard!");
            const shareText = text + "\nmaiapp.se"
            navigator.clipboard.writeText(shareText);
            linkCopiedText.style.display = 'flex';
            shareCodeButton.style.display = 'none';
        }
    });

    window.intercomSettings = {
        app_id: "klyy0le5"
    };
    (function () { var w = window; var ic = w.Intercom; if (typeof ic === "function") { ic('reattach_activator'); ic('update', w.intercomSettings); } else { var d = document; var i = function () { i.c(arguments); }; i.q = []; i.c = function (args) { i.q.push(args); }; w.Intercom = i; var l = function () { var s = d.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = 'https://widget.intercom.io/widget/klyy0le5'; var x = d.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x); }; if (w.attachEvent) { w.attachEvent('onload', l); } else { w.addEventListener('load', l, false); } } })();
</script>