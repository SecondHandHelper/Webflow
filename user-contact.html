<script>
    const pageSetUp = async () => {
        mobilePhone.addEventListener('input', fieldLabelToggle('mobilePhoneLabel'));
        personalId.addEventListener('input', fieldLabelToggle('personalIdLabel'));

        saveUserDetailsButton.addEventListener('click', async () => {
          const mobilePhoneError = mobilePhone.value?.length < 9 ? 'Ange ditt mobilnummer' : '';
          mobilePhone.setCustomValidity(mobilePhoneError);
          const personalIdError = !personalId.value?.length || isValidSwedishSsn(personalId.value) ?
                  '' : 'Ange ett giltigt personnummer';
          personalId.setCustomValidity(personalIdError);
          if (reportValidity()) {
              try {
                  await firebase.app().functions("europe-west1").httpsCallable('updateFirebaseUser')(
                      { phoneNumber: mobilePhone.value, personalId: personalId.value }
                  );
              } catch (e) {
                  console.error('Failed saving user contact info', e);
              }
              location.href = `/item-confirmation${params.id ? '?id=' + params.id : ''}`;
          }
        });
    }

    pageSetUp();
</script>
